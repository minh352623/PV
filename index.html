<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interview Prep ‚Äî Golang ¬∑ Database ¬∑ Message Broker ¬∑ Architecture ¬∑ Engineering</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,600;1,400&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,700;0,9..144,900;1,9..144,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f0e8;
  --bg2: #ede8df;
  --bg3: #e5dfd4;
  --ink: #1a1612;
  --ink2: #3d3530;
  --ink3: #6b5e55;
  --ink4: #9c8e87;
  --go: #00acd7;
  --go-bg: rgba(0,172,215,0.08);
  --go-border: rgba(0,172,215,0.25);
  --db: #336791;
  --db-bg: rgba(51,103,145,0.08);
  --db-border: rgba(51,103,145,0.25);
  --kafka: #e85d04;
  --kafka-bg: rgba(232,93,4,0.08);
  --kafka-border: rgba(232,93,4,0.25);
  --green: #2d6a4f;
  --green-bg: rgba(45,106,79,0.08);
  --red: #ae2012;
  --yellow: #7b5e00;
  --yellow-bg: rgba(123,94,0,0.1);
  --shadow: 0 2px 12px rgba(26,22,18,0.08);
  --shadow-lg: 0 8px 32px rgba(26,22,18,0.12);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'Fraunces', Georgia, serif;
  min-height: 100vh;
  padding: 0;
}

/* ‚îÄ‚îÄ‚îÄ NOISE TEXTURE ‚îÄ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

/* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
.masthead {
  background: var(--ink);
  color: var(--bg);
  padding: 52px 48px 44px;
  position: relative;
  overflow: hidden;
}
.masthead::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--go), var(--db), var(--kafka));
}
.masthead-eyebrow {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 18px;
  display: flex;
  gap: 16px;
  align-items: center;
}
.masthead-eyebrow::before {
  content: '';
  width: 32px; height: 1px;
  background: var(--ink4);
}
.masthead h1 {
  font-size: clamp(36px, 5vw, 64px);
  font-weight: 900;
  line-height: 1.0;
  letter-spacing: -2px;
  margin-bottom: 16px;
}
.masthead h1 em {
  font-style: italic;
  font-weight: 300;
  color: var(--ink4);
}
.masthead-sub {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 12px;
  color: var(--ink3);
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
  margin-top: 20px;
}
.pill {
  padding: 4px 12px;
  border-radius: 2px;
  font-size: 10px;
  font-family: 'IBM Plex Mono', monospace;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
}
.pill.go { background: var(--go); color: #fff; }
.pill.db { background: var(--db); color: #fff; }
.pill.kafka { background: var(--kafka); color: #fff; }

/* ‚îÄ‚îÄ‚îÄ NAV TABS ‚îÄ‚îÄ‚îÄ */
.nav-tabs {
  display: flex;
  background: var(--ink);
  border-bottom: 1px solid rgba(255,255,255,0.05);
  padding: 0 48px;
  gap: 0;
  position: sticky;
  top: 0;
  z-index: 100;
}
.tab-btn {
  padding: 14px 24px;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--ink4);
  background: none;
  border: none;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  position: relative;
  top: 1px;
}
.tab-btn:hover { color: var(--bg); }
.tab-btn.active { color: var(--bg); }
.tab-btn.active.go-tab { border-bottom-color: var(--go); }
.tab-btn.active.db-tab { border-bottom-color: var(--db); }
.tab-btn.active.kafka-tab { border-bottom-color: var(--kafka); }

/* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */
.content-area {
  max-width: 1020px;
  margin: 0 auto;
  padding: 48px 40px;
}

.section { display: none; }
.section.active { display: block; }

/* ‚îÄ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ‚îÄ */
.section-head {
  display: flex;
  align-items: baseline;
  gap: 16px;
  margin-bottom: 40px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--bg3);
}
.section-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--ink4);
  letter-spacing: 2px;
}
.section-title {
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

/* ‚îÄ‚îÄ‚îÄ QUESTION CARD ‚îÄ‚îÄ‚îÄ */
.q-card {
  background: #fff;
  border: 1px solid var(--bg3);
  border-radius: 4px;
  margin-bottom: 20px;
  box-shadow: var(--shadow);
  overflow: hidden;
  transition: box-shadow 0.2s;
}
.q-card:hover { box-shadow: var(--shadow-lg); }

.q-header {
  padding: 20px 24px;
  cursor: pointer;
  display: flex;
  align-items: flex-start;
  gap: 16px;
  user-select: none;
}
.q-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink4);
  min-width: 28px;
  padding-top: 3px;
  letter-spacing: 1px;
}
.q-text {
  flex: 1;
  font-size: 16px;
  font-weight: 700;
  line-height: 1.4;
  color: var(--ink);
}
.q-level {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  padding: 3px 8px;
  border-radius: 2px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  flex-shrink: 0;
  margin-top: 2px;
}
.q-level.easy { background: var(--green-bg); color: var(--green); border: 1px solid rgba(45,106,79,0.2); }
.q-level.med { background: var(--yellow-bg); color: var(--yellow); border: 1px solid rgba(123,94,0,0.2); }
.q-level.hard { background: rgba(174,32,18,0.08); color: var(--red); border: 1px solid rgba(174,32,18,0.2); }
.q-toggle {
  color: var(--ink4);
  font-size: 18px;
  flex-shrink: 0;
  transition: transform 0.25s;
  padding-top: 2px;
  font-family: 'IBM Plex Mono', monospace;
}
.q-card.open .q-toggle { transform: rotate(45deg); }

.q-body {
  display: none;
  padding: 4px 24px 28px 24px;
  border-top: 1px solid var(--bg3);
}
.q-card.open .q-body { display: block; }

/* Answer sections */
.ans-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink4);
  margin: 20px 0 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.ans-label::after { content: ''; flex: 1; height: 1px; background: var(--bg3); }

.answer-text {
  font-size: 14px;
  line-height: 1.75;
  color: var(--ink2);
}
.answer-text p { margin-bottom: 10px; }
.answer-text strong { color: var(--ink); font-weight: 700; }
.answer-text code, .key-points code, .trap-box code, .tip-box code {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 12px;
  background: var(--bg3);
  color: var(--ink);
  padding: 1px 5px;
  border-radius: 3px;
  border: 1px solid rgba(0,0,0,0.08);
}

/* ‚îÄ‚îÄ‚îÄ CODE BLOCK ‚îÄ‚îÄ‚îÄ */
.code-block {
  background: #16120e;
  color: #e8e0d8;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 12.5px;
  line-height: 1.8;
  border-radius: 8px;
  margin: 18px 0;
  overflow: hidden;
  position: relative;
  box-shadow: 0 4px 24px rgba(0,0,0,0.22);
  border: 1px solid rgba(255,255,255,0.07);
}
/* Title bar */
.code-block::before {
  content: '‚óè ‚óè ‚óè';
  display: flex;
  align-items: center;
  background: #1a1510;
  color: #3d3530;
  font-size: 9px;
  letter-spacing: 5px;
  padding: 9px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  height: 32px;
}
.code-block-inner {
  padding: 16px 20px 18px;
  overflow-x: auto;
  display: block;
  white-space: pre;
  /* Custom scrollbar */
  scrollbar-width: thin;
  scrollbar-color: #3d3530 transparent;
}
.code-block-inner::-webkit-scrollbar { height: 4px; }
.code-block-inner::-webkit-scrollbar-track { background: transparent; }
.code-block-inner::-webkit-scrollbar-thumb { background: #3d3530; border-radius: 2px; }

/* Syntax tokens ‚Äî inline within pre-formatted text */
.code-block .kw   { color: #7ec8e3; font-weight: 600; }
.code-block .fn   { color: #f4b860; }
.code-block .cm   { color: #5a5248; font-style: italic; }
.code-block .str  { color: #a8d8a8; }
.code-block .num  { color: #f4a261; }
.code-block .type { color: #c9a96e; }

/* ‚îÄ‚îÄ‚îÄ KEY POINTS ‚îÄ‚îÄ‚îÄ */
.key-points {
  background: var(--bg);
  border: 1px solid var(--bg3);
  border-left: 3px solid var(--ink3);
  border-radius: 0 8px 8px 0;
  padding: 0;
  margin: 18px 0;
  overflow: hidden;
}
.key-points ul {
  list-style: none;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
}
.key-points li {
  font-size: 13px;
  color: var(--ink2);
  display: flex;
  gap: 10px;
  line-height: 1.6;
  align-items: flex-start;
  padding: 12px 16px;
  border-bottom: 1px solid var(--bg3);
  border-right: 1px solid var(--bg3);
}
.key-points li:nth-child(even) { border-right: none; }
.key-points li:nth-last-child(-n+2):nth-child(odd),
.key-points li:nth-last-child(-n+2):nth-child(odd) ~ li { border-bottom: none; }
.key-points li::before {
  content: '‚Üí';
  color: var(--ink4);
  flex-shrink: 0;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  margin-top: 2px;
}
/* Full-width overrides */
.key-points ul li:only-child { grid-column: 1 / -1; border-right: none; }
.key-points ul li:last-child:nth-child(odd) { grid-column: 1 / -1; border-right: none; }

/* ‚îÄ‚îÄ‚îÄ BOXES ‚îÄ‚îÄ‚îÄ */
.trap-box {
  background: rgba(174,32,18,0.04);
  border: 1px solid rgba(174,32,18,0.18);
  border-left: 3px solid var(--red);
  border-radius: 0 6px 6px 0;
  padding: 14px 16px;
  margin: 14px 0;
}
.trap-box-title {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  font-weight: 600;
  color: var(--red);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.trap-box p {
  font-size: 13px;
  color: var(--ink2);
  line-height: 1.6;
}
.trap-box strong { color: var(--red); }

.tip-box {
  background: var(--green-bg);
  border: 1px solid rgba(45,106,79,0.2);
  border-left: 3px solid var(--green);
  border-radius: 0 6px 6px 0;
  padding: 14px 16px;
  margin: 14px 0;
}
.tip-box-title {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  font-weight: 600;
  color: var(--green);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.tip-box p {
  font-size: 13px;
  color: var(--ink2);
  line-height: 1.6;
}

/* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */

/* Tablet */
@media (max-width: 900px) {
  .content-area { max-width: 100%; }
  .key-points ul { grid-template-columns: 1fr 1fr; }
}

/* Mobile */
@media (max-width: 640px) {
  .masthead { padding: 28px 20px 24px; }
  .masthead-sub { gap: 8px; }
  .nav-tabs {
    padding: 0 4px;
    overflow-x: auto;
    flex-wrap: nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .nav-tabs::-webkit-scrollbar { display: none; }
  .tab-btn { padding: 12px 12px; font-size: 10px; white-space: nowrap; letter-spacing: 0.8px; }
  .content-area { padding: 20px 14px; }
  .q-header { padding: 14px 14px; gap: 8px; }
  .q-text { font-size: 14px; }
  .q-level { display: none; }
  .q-body { padding: 0 14px 18px 14px; }
  /* Code: smaller font, keep scrollable */
  .code-block { font-size: 11px; margin: 12px 0; }
  .code-block-inner { padding: 12px 14px 14px; }
  /* Key points: single column on mobile */
  .key-points ul { grid-template-columns: 1fr; }
  .key-points li { border-right: none !important; }
  .key-points li:nth-last-child(-n+2):nth-child(odd),
  .key-points li:nth-last-child(-n+2):nth-child(odd) ~ li { border-bottom: 1px solid var(--bg3); }
  .key-points li:last-child { border-bottom: none !important; }
  /* Boxes */
  .trap-box, .tip-box { padding: 12px 14px; }
  .ans-label { font-size: 8px; }
  /* Section head */
  .section-head { margin-bottom: 24px; }
  .section-title { font-size: 22px; }
}

/* ‚îÄ‚îÄ‚îÄ CATEGORY LABEL ‚îÄ‚îÄ‚îÄ */
.cat-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--ink4);
  margin: 36px 0 14px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.cat-label::before { content: '//'; color: var(--ink4); }
.cat-label::after { content: ''; flex: 1; height: 1px; background: var(--bg3); }

/* Top border color per section */
.section-go .q-card { border-top: 2px solid var(--go); }
.section-db .q-card { border-top: 2px solid var(--db); }
.section-kafka .q-card { border-top: 2px solid var(--kafka); }
.section-arch .q-card { border-top: 2px solid var(--arch); }
.section-eng .q-card { border-top: 2px solid var(--eng); }

/* new tab colors */
:root {
  --arch: #7c3aed;
  --arch-bg: rgba(124,58,237,0.08);
  --eng: #0f766e;
  --eng-bg: rgba(15,118,110,0.08);
}
.tab-btn.active.arch-tab { border-bottom-color: var(--arch); }
.tab-btn.active.eng-tab { border-bottom-color: var(--eng); }
.tab-btn.active.nest-tab { border-bottom-color: var(--nest); }
.pill.arch { background: var(--arch); color: #fff; }
.pill.eng { background: var(--eng); color: #fff; }
.pill.nest { background: var(--nest); color: #fff; }
:root { --nest: #e0234e; }
.section-nest .q-card { border-top: 2px solid var(--nest); }
</style>
<script>
function switchTab(tab, btn) {
  document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
  document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
  document.getElementById('sec-' + tab).classList.add('active');
  btn.classList.add('active');
}
function toggleCard(card) {
  card.classList.toggle('open');
}
</script>
</head>
<body>

<!-- MASTHEAD -->
<div class="masthead">
  <div class="masthead-eyebrow">Interview Preparation Guide</div>
  <h1>Backend <em>Interview</em><br>Question Bank</h1>
  <div class="masthead-sub">
    <span><span class="pill go">Golang Core</span></span>
    <span><span class="pill db">Database</span></span>
    <span><span class="pill kafka">Message Broker</span></span>
    <span><span class="pill arch">Architecture & Security</span></span>
    <span><span class="pill eng">Engineering Process</span></span>
    <span><span class="pill nest">NestJS / Node.js</span></span>
  </div>
</div>

<!-- NAV TABS -->
<div class="nav-tabs">
  <button class="tab-btn go-tab active" onclick="switchTab('go', this)">‚¨° Golang Core</button>
  <button class="tab-btn db-tab" onclick="switchTab('db', this)">‚ó´ Database</button>
  <button class="tab-btn kafka-tab" onclick="switchTab('kafka', this)">‚áå Message Broker</button>
  <button class="tab-btn arch-tab" onclick="switchTab('arch', this)">‚óà Architecture & Security</button>
  <button class="tab-btn eng-tab" onclick="switchTab('eng', this)">‚ú¶ Engineering Process</button>
  <button class="tab-btn nest-tab" onclick="switchTab('nest', this)">‚¨° NestJS / Node.js</button>
</div>

<div class="content-area">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECTION: GOLANG -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="sec-go" class="section active section-go">
  <div class="section-head">
    <span class="section-num">01</span>
    <h2 class="section-title">Golang Core</h2>
  </div>

  <div class="cat-label">OOP & Language Design</div>

  <!-- Q-inherit-1 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">A1</span>
      <span class="q-text">Go c√≥ Inheritance kh√¥ng? Inheritance l√† g√¨? Java c√≥ ƒëa k·∫ø th·ª´a kh√¥ng, t·∫°i sao?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>Inheritance (k·∫ø th·ª´a)</strong> l√† c∆° ch·∫ø trong OOP cho ph√©p class con (subclass) t·ª± ƒë·ªông nh·∫≠n t·∫•t c·∫£ properties v√† methods c·ªßa class cha (superclass). M·ª•c ƒë√≠ch: t√°i s·ª≠ d·ª•ng code, t·∫°o quan h·ªá "is-a".</p>
        <p><strong>Go KH√îNG c√≥ inheritance</strong>. Thay v√†o ƒë√≥ Go d√πng <strong>Composition (Embedding)</strong> ‚Äî quan h·ªá "has-a" thay v√¨ "is-a". ƒê√¢y l√† tri·∫øt l√Ω thi·∫øt k·∫ø c·ªë √Ω c·ªßa Go: <em>"Favor composition over inheritance"</em>.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Go: Composition thay v√¨ Inheritance</span>
<span class="kw">type</span> Animal <span class="kw">struct</span> {
    Name <span class="kw">string</span>
}
<span class="kw">func</span> (a Animal) <span class="fn">Speak</span>() <span class="kw">string</span> { <span class="kw">return</span> a.Name + <span class="str">" speaks"</span> }

<span class="kw">type</span> Dog <span class="kw">struct</span> {
    Animal           <span class="cm">// embed ‚Äî promote Animal methods l√™n Dog</span>
    Breed <span class="kw">string</span>
}

d := Dog{Animal: Animal{Name: <span class="str">"Rex"</span>}, Breed: <span class="str">"Husky"</span>}
d.<span class="fn">Speak</span>() <span class="cm">// "Rex speaks" ‚Äî g·ªçi ƒë∆∞·ª£c nh∆∞ inheritance</span>
d.Name    <span class="cm">// promoted field</span>

<span class="cm">// Dog KH√îNG ph·∫£i Animal (no "is-a")</span>
<span class="cm">// Nh∆∞ng Dog c√≥ behavior c·ªßa Animal (has-a via embedding)</span></div></div>
      <div class="key-points"><ul>
        <li><strong>Java c√≥ ƒëa k·∫ø th·ª´a kh√¥ng?</strong> ‚Äî Java <strong>KH√îNG cho ph√©p ƒëa k·∫ø th·ª´a class</strong> (Diamond Problem). M·ªôt class ch·ªâ extends ƒë∆∞·ª£c 1 class.</li>
        <li><strong>Diamond Problem</strong>: n·∫øu A extends B v√† C, c·∫£ B v√† C ƒë·ªÅu c√≥ method <code>foo()</code>, th√¨ A g·ªçi <code>foo()</code> c·ªßa ai? Ambiguous ‚Üí Java c·∫•m.</li>
        <li>Java <strong>c√≥ th·ªÉ implements nhi·ªÅu interface</strong> ‚Äî v√¨ interface kh√¥ng c√≥ implementation (tr∆∞·ªõc Java 8), n√™n kh√¥ng c√≥ conflict.</li>
        <li>T·ª´ Java 8: <code>default method</code> trong interface ‚Äî n·∫øu conflict th√¨ b·∫Øt bu·ªôc override.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° C√¢u tr·∫£ l·ªùi senior level</div>
        <p>"Go ch·ªçn composition over inheritance v√¨ inheritance t·∫°o ra tight coupling ‚Äî thay ƒë·ªïi class cha ·∫£nh h∆∞·ªüng to√†n b·ªô class con. Composition linh ho·∫°t h∆°n: thay ƒë·ªïi m·ªôt component kh√¥ng ·∫£nh h∆∞·ªüng component kh√°c. Trong Go, interface + embedding cho ph√©p polymorphism m√† kh√¥ng c·∫ßn inheritance hierarchy."</p>
      </div>
    </div>
  </div>

  <!-- Q-arch-go -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">A2</span>
      <span class="q-text">M√¥ t·∫£ ki·∫øn tr√∫c Go m√† em ƒë√£ s·ª≠ d·ª•ng trong d·ª± √°n th·ª±c t·∫ø?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">C√°ch tr·∫£ l·ªùi ‚Äî k·ªÉ journey t·ª´ ƒë∆°n gi·∫£n ƒë·∫øn ph·ª©c t·∫°p</div>
      <div class="answer-text">
        <p>M√¨nh ƒë√£ d√πng <strong>nhi·ªÅu ki·∫øn tr√∫c kh√°c nhau t√πy theo quy m√¥ v√† y√™u c·∫ßu c·ªßa t·ª´ng d·ª± √°n</strong>. ƒêi·ªÅu quan tr·ªçng l√† bi·∫øt <em>khi n√†o d√πng c√°i g√¨</em> ‚Äî kh√¥ng ph·∫£i m·ªçi d·ª± √°n ƒë·ªÅu c·∫ßn DDD hay Microservices.</p>
      </div>

      <div class="ans-label">1 ‚Äî MVC: Kh·ªüi ƒëi·ªÉm ƒë∆°n gi·∫£n</div>
      <div class="answer-text">
        <p>V·ªõi d·ª± √°n nh·ªè ho·∫∑c MVP, m√¨nh d√πng <strong>MVC</strong> ‚Äî nhanh, d·ªÖ onboard, √≠t boilerplate.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// MVC structure ‚Äî ƒë∆°n gi·∫£n, ph√π h·ª£p team nh·ªè / CRUD app</span>
cmd/main.go
internal/
  model/          <span class="cm">// struct + DB mapping (GORM models)</span>
    user.go
  controller/     <span class="cm">// nh·∫≠n request, g·ªçi service, tr·∫£ response</span>
    user_ctrl.go
  service/        <span class="cm">// business logic</span>
    user_svc.go
  repository/     <span class="cm">// DB queries</span>
    user_repo.go
router/
  routes.go       <span class="cm">// Gin/Fiber route registration</span></div></div>

      <div class="ans-label">2 ‚Äî Clean Architecture + DDD: Khi domain ph·ª©c t·∫°p</div>
      <div class="answer-text">
        <p>Khi business logic ph·ª©c t·∫°p h∆°n, c·∫ßn test t·ªët h∆°n, m√¨nh chuy·ªÉn sang <strong>Clean Architecture k·∫øt h·ª£p DDD concepts</strong>. Dependency rule: ph·ª• thu·ªôc ch·ªâ ƒëi t·ª´ ngo√†i v√†o trong.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Clean Architecture ‚Äî dependency rule: outer ‚Üí inner only</span>
internal/
  domain/                    <span class="cm">// ‚Üê CORE: zero external dependencies</span>
    entity/
      user.go                <span class="cm">// business entity + domain rules</span>
      video.go
    valueobject/
      email.go               <span class="cm">// DDD value object: immutable, validated</span>
    repository/              <span class="cm">// interfaces ONLY ‚Äî no impl here</span>
      user_repository.go
    usecase/                 <span class="cm">// orchestrate domain objects</span>
      create_user.go
      get_feed.go
  infrastructure/            <span class="cm">// ‚Üê OUTER: implements domain interfaces</span>
    postgres/
      user_pg_repo.go        <span class="cm">// UserRepository interface ‚Üí Postgres</span>
    redis/
      feed_cache.go          <span class="cm">// FeedCache interface ‚Üí Redis</span>
    clickhouse/
      event_repo.go          <span class="cm">// EventRepository ‚Üí ClickHouse</span>
    mongodb/
      content_repo.go        <span class="cm">// ContentRepository ‚Üí MongoDB</span>
  delivery/
    http/
      user_handler.go        <span class="cm">// parse request ‚Üí call usecase ‚Üí format resp</span>
    grpc/
      recommendation_svc.go  <span class="cm">// gRPC handler for AI service</span>
pkg/
  middleware/                <span class="cm">// auth, rate limit, logging</span>
  config/                    <span class="cm">// viper config loading</span>

<span class="cm">// DDD Concepts applied:</span>
<span class="cm">// Entity: User{ID, Email, ...} ‚Äî c√≥ identity, c√≥ th·ªÉ thay ƒë·ªïi</span>
<span class="cm">// Value Object: Email{value} ‚Äî immutable, defined by value</span>
<span class="cm">// Aggregate: Order ch·ª©a OrderItems ‚Äî consistency boundary</span>
<span class="cm">// Repository: interface ƒë·ªÉ persist/retrieve aggregates</span>
<span class="cm">// Usecase = Application Service: orchestrate domain objects</span></div></div>

      <div class="ans-label">3 ‚Äî Microservices: Khi scale team v√† ƒë·ªôc l·∫≠p deployment</div>
      <div class="answer-text">
        <p>Khi team l·ªõn h∆°n v√† c·∫ßn deploy ƒë·ªôc l·∫≠p t·ª´ng service, m√¨nh √°p d·ª•ng <strong>Microservices</strong>. M·ªói service l√† m·ªôt Go binary ri√™ng v·ªõi DB ri√™ng (Database per Service pattern).</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Microservices layout th·ª±c t·∫ø</span>
services/
  user-service/             <span class="cm">// owns: PostgreSQL users table</span>
    cmd/main.go
    internal/...            <span class="cm">// Clean Architecture b√™n trong</span>
  video-service/            <span class="cm">// owns: PostgreSQL videos + MongoDB content</span>
    cmd/main.go
    internal/...
  recommendation-service/   <span class="cm">// owns: Redis pool + ClickHouse reads</span>
    cmd/main.go
    internal/...
  notification-service/     <span class="cm">// consumes events from Kafka/RabbitMQ</span>

shared/
  proto/                    <span class="cm">// gRPC proto definitions (shared contract)</span>
  events/                   <span class="cm">// Kafka event schema (shared)</span>

<span class="cm">// Communication patterns:</span>
<span class="cm">// Sync:  gRPC (internal service-to-service)</span>
<span class="cm">// Async: Kafka / RabbitMQ (event-driven)</span>
<span class="cm">// External: REST API qua API Gateway</span></div></div>

      <div class="key-points"><ul>
        <li><strong>MVC</strong>: d√πng khi team nh·ªè, CRUD app, c·∫ßn ship nhanh. √çt abstraction, d·ªÖ ƒë·ªçc v·ªõi junior.</li>
        <li><strong>Clean Architecture + DDD</strong>: d√πng khi domain ph·ª©c t·∫°p, c·∫ßn testability cao, team mu·ªën isolate business logic kh·ªèi infrastructure.</li>
        <li><strong>Microservices</strong>: d√πng khi c·∫ßn scale ƒë·ªôc l·∫≠p, team l·ªõn (2-pizza rule), deployment frequency cao. <strong>Kh√¥ng n√™n √°p d·ª•ng s·ªõm</strong> ‚Äî overhead l·ªõn.</li>
        <li><strong>Nguy√™n t·∫Øc ch·ªçn</strong>: b·∫Øt ƒë·∫ßu t·ª´ Monolith v·ªõi Clean Architecture, sau ƒë√≥ t√°ch d·∫ßn th√†nh Microservices khi th·ª±c s·ª± c·∫ßn.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° C√¢u tr·∫£ l·ªùi g√¢y ·∫•n t∆∞·ª£ng m·∫°nh v·ªõi interviewer</div>
        <p>"M√¨nh kh√¥ng √°p d·ª•ng m·ªôt ki·∫øn tr√∫c c·ªë ƒë·ªãnh cho m·ªçi d·ª± √°n. Microservices gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ v·ªÅ scaling v√† team independence, nh∆∞ng ƒë·ªïi l·∫°i l√† distributed system complexity ‚Äî network latency, distributed transactions, observability. M√¨nh ch·ªçn ki·∫øn tr√∫c d·ª±a tr√™n <strong>team size, domain complexity, v√† scaling requirements</strong> ‚Äî kh√¥ng ph·∫£i v√¨ n√≥ 'trend'."</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Concurrency</div>

  <!-- Q1 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">01</span>
      <span class="q-text">Goroutine kh√°c Thread nh∆∞ th·∫ø n√†o? T·∫°i sao Goroutine nh·∫π h∆°n?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Goroutine l√† <strong>lightweight thread ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi Go runtime</strong>, kh√¥ng ph·∫£i OS thread. S·ª± kh√°c bi·ªát ch√≠nh:</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Stack size</strong>: Goroutine b·∫Øt ƒë·∫ßu v·ªõi ~2KB stack, t·ª± ƒë·ªông grow/shrink. OS thread c·ªë ƒë·ªãnh 1‚Äì8MB.</li>
        <li><strong>Scheduling</strong>: Go d√πng M:N scheduler (nhi·ªÅu goroutines map l√™n √≠t OS threads). OS thread d√πng preemptive scheduling c·ªßa kernel ‚Äî t·ªën context switch.</li>
        <li><strong>Context switch</strong>: Goroutine switch trong user-space (~100ns). OS thread switch qua kernel (~1‚Äì10¬µs).</li>
        <li><strong>Creation cost</strong>: Spawn 1 goroutine r·∫ª h∆°n r·∫•t nhi·ªÅu ‚Äî c√≥ th·ªÉ ch·∫°y h√†ng tri·ªáu goroutines.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° ƒêi·ªÉm c·ªông khi tr·∫£ l·ªùi</div>
        <p>ƒê·ªÅ c·∫≠p ƒë·∫øn <strong>GOMAXPROCS</strong>: s·ªë OS threads ch·∫°y song song = s·ªë CPU cores. V√† <strong>work-stealing scheduler</strong>: goroutine idle s·∫Ω b·ªã "steal" b·ªüi thread kh√°c ƒë·ªÉ t·∫≠n d·ª•ng CPU.</p>
      </div>
    </div>
  </div>

  <!-- Q2 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">02</span>
      <span class="q-text">Channel buffered vs unbuffered kh√°c nhau th·∫ø n√†o? Khi n√†o d√πng c√°i n√†o?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>Unbuffered</strong>: sender block cho ƒë·∫øn khi receiver s·∫µn s√†ng nh·∫≠n ‚Äî ƒë·ªìng b·ªô ho√†n to√†n (rendezvous).</p>
        <p><strong>Buffered</strong>: sender ch·ªâ block khi buffer ƒë·∫ßy ‚Äî c√≥ th·ªÉ g·ª≠i tr∆∞·ªõc khi receiver nh·∫≠n.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Unbuffered ‚Äî sync</span>
ch := <span class="fn">make</span>(<span class="kw">chan</span> <span class="kw">int</span>)        <span class="cm">// block until recv</span>

<span class="cm">// Buffered ‚Äî async up to capacity</span>
ch := <span class="fn">make</span>(<span class="kw">chan</span> <span class="kw">int</span>, <span class="num">10</span>)    <span class="cm">// block only when full</span></div></div>
      <div class="key-points"><ul>
        <li><strong>Unbuffered</strong>: d√πng khi c·∫ßn guarantee "message ƒë√£ ƒë∆∞·ª£c nh·∫≠n" tr∆∞·ªõc khi ti·∫øp t·ª•c. V√≠ d·ª•: signal done, handshake.</li>
        <li><strong>Buffered</strong>: d√πng khi producer nhanh h∆°n consumer, mu·ªën gi·∫£m blocking. V√≠ d·ª•: job queue, event pipeline.</li>
        <li>ƒê·ª´ng d√πng buffered ƒë·ªÉ "fix" race condition ‚Äî ƒë√≥ l√† che gi·∫•u bug.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† B·∫´y hay g·∫∑p</div>
        <p>G·ª≠i v√†o closed channel ‚Üí <strong>panic</strong>. Nh·∫≠n t·ª´ closed channel ‚Üí tr·∫£ v·ªÅ zero value + <code>ok=false</code>. Interviewer hay h·ªèi: "Ai n√™n close channel?" ‚Äî Quy t·∫Øc: <strong>sender close, kh√¥ng ph·∫£i receiver</strong>.</p>
      </div>
    </div>
  </div>

  <!-- Q3 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">03</span>
      <span class="q-text">sync.Mutex vs sync.RWMutex ‚Äî khi n√†o d√πng g√¨? Race condition l√† g√¨?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>Race condition</strong>: x·∫£y ra khi 2+ goroutines ƒë·ªçc/ghi c√πng m·ªôt bi·∫øn m√† kh√¥ng c√≥ synchronization. K·∫øt qu·∫£ kh√¥ng deterministic.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Mutex</strong>: Lock exclusive ‚Äî ch·ªâ 1 goroutine v√†o critical section t·∫°i m·ªôt th·ªùi ƒëi·ªÉm (ƒë·ªçc ho·∫∑c ghi).</li>
        <li><strong>RWMutex</strong>: Nhi·ªÅu goroutines c√≥ th·ªÉ <strong>RLock</strong> (read) ƒë·ªìng th·ªùi, nh∆∞ng <strong>Lock</strong> (write) th√¨ exclusive. T·ªët khi read nhi·ªÅu, write √≠t.</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="kw">var</span> mu sync.RWMutex
<span class="kw">var</span> cache = <span class="fn">make</span>(<span class="kw">map</span>[<span class="kw">string</span>]<span class="kw">string</span>)

<span class="cm">// Nhi·ªÅu goroutine read c√πng l√∫c OK</span>
<span class="kw">func</span> <span class="fn">Get</span>(key <span class="kw">string</span>) <span class="kw">string</span> {
    mu.<span class="fn">RLock</span>(); <span class="kw">defer</span> mu.<span class="fn">RUnlock</span>()
    <span class="kw">return</span> cache[key]
}

<span class="cm">// Write ph·∫£i exclusive</span>
<span class="kw">func</span> <span class="fn">Set</span>(key, val <span class="kw">string</span>) {
    mu.<span class="fn">Lock</span>(); <span class="kw">defer</span> mu.<span class="fn">Unlock</span>()
    cache[key] = val
}</div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Bonus</div>
        <p>Mention <strong>go run -race</strong> ƒë·ªÉ detect race condition. Interviewer s·∫Ω r·∫•t ·∫•n t∆∞·ª£ng n·∫øu b·∫°n bi·∫øt tool n√†y.</p>
      </div>
    </div>
  </div>

  <!-- Q4 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">04</span>
      <span class="q-text">Context trong Go d√πng ƒë·ªÉ l√†m g√¨? cancel, timeout, deadline kh√°c nhau ra sao?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Context d√πng ƒë·ªÉ <strong>truy·ªÅn signal h·ªßy, timeout, v√† metadata</strong> qua call chain. ƒê·∫∑c bi·ªát quan tr·ªçng trong concurrent code v√† HTTP handlers.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// WithCancel ‚Äî manually cancel</span>
ctx, cancel := context.<span class="fn">WithCancel</span>(context.<span class="fn">Background</span>())
<span class="kw">defer</span> <span class="fn">cancel</span>() <span class="cm">// lu√¥n defer cancel ƒë·ªÉ tr√°nh leak</span>

<span class="cm">// WithTimeout ‚Äî auto cancel sau duration</span>
ctx, cancel := context.<span class="fn">WithTimeout</span>(context.<span class="fn">Background</span>(), <span class="num">5</span>*time.Second)

<span class="cm">// WithDeadline ‚Äî cancel t·∫°i th·ªùi ƒëi·ªÉm c·ª• th·ªÉ</span>
ctx, cancel := context.<span class="fn">WithDeadline</span>(context.<span class="fn">Background</span>(), deadline)

<span class="cm">// Check trong goroutine</span>
<span class="kw">select</span> {
<span class="kw">case</span> &lt;-ctx.<span class="fn">Done</span>():
    <span class="kw">return</span> ctx.<span class="fn">Err</span>() <span class="cm">// context.Canceled ho·∫∑c DeadlineExceeded</span>
<span class="kw">case</span> result := &lt;-doWork():
    <span class="kw">return</span> result
}</div></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† B·∫´y hay g·∫∑p</div>
        <p>Qu√™n <code>defer cancel()</code> ‚Üí <strong>goroutine leak</strong>. Context kh√¥ng th·ªÉ cancel parent ‚Äî ch·ªâ cancel down the tree. Kh√¥ng store context trong struct, lu√¥n pass qua function parameter.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Memory & Runtime</div>

  <!-- Q5 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">05</span>
      <span class="q-text">Heap vs Stack allocation trong Go. Escape Analysis l√† g√¨?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>Stack</strong>: nhanh, t·ª± ƒë·ªông deallocate khi function return. <strong>Heap</strong>: ch·∫≠m h∆°n, c·∫ßn GC d·ªçn d·∫πp.</p>
        <p><strong>Escape Analysis</strong>: compiler ph√¢n t√≠ch xem variable c√≥ "tho√°t" ra ngo√†i function scope kh√¥ng. N·∫øu c√≥ ‚Üí allocate heap. N·∫øu kh√¥ng ‚Üí stack.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Stack ‚Äî kh√¥ng escape</span>
<span class="kw">func</span> <span class="fn">foo</span>() <span class="kw">int</span> {
    x := <span class="num">42</span>    <span class="cm">// x tr√™n stack, m·∫•t khi foo() return</span>
    <span class="kw">return</span> x
}

<span class="cm">// Heap ‚Äî escape v√¨ return pointer</span>
<span class="kw">func</span> <span class="fn">bar</span>() *<span class="kw">int</span> {
    x := <span class="num">42</span>    <span class="cm">// x escape to heap</span>
    <span class="kw">return</span> &amp;x
}

<span class="cm">// Xem escape analysis:</span>
<span class="cm">// go build -gcflags="-m" .</span></div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° ƒêi·ªÉm c·ªông</div>
        <p>Interface{} th∆∞·ªùng g√¢y escape to heap v√¨ compiler kh√¥ng bi·∫øt type l√∫c compile. D√πng <strong>sync.Pool</strong> ƒë·ªÉ t√°i s·ª≠ d·ª•ng objects, gi·∫£m GC pressure.</p>
      </div>
    </div>
  </div>

  <!-- Q6 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">06</span>
      <span class="q-text">Interface trong Go ho·∫°t ƒë·ªông th·∫ø n√†o? Duck typing l√† g√¨?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Go d√πng <strong>implicit interface implementation</strong> ‚Äî kh√¥ng c·∫ßn khai b√°o <code>implements</code>. N·∫øu type c√≥ ƒë·ªß methods c·ªßa interface ‚Üí t·ª± ƒë·ªông implement. ƒê√¢y l√† Duck Typing: <em>"n·∫øu n√≥ ƒëi nh∆∞ v·ªãt v√† k√™u nh∆∞ v·ªãt, th√¨ n√≥ l√† v·ªãt."</em></p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="kw">type</span> Writer <span class="kw">interface</span> {
    <span class="fn">Write</span>(p []<span class="kw">byte</span>) (n <span class="kw">int</span>, err <span class="kw">error</span>)
}

<span class="cm">// FileWriter t·ª± ƒë·ªông implement Writer</span>
<span class="cm">// m√† kh√¥ng c·∫ßn "implements Writer"</span>
<span class="kw">type</span> FileWriter <span class="kw">struct</span>{}
<span class="kw">func</span> (f FileWriter) <span class="fn">Write</span>(p []<span class="kw">byte</span>) (<span class="kw">int</span>, <span class="kw">error</span>) {
    <span class="cm">// ...</span>
    <span class="kw">return</span> <span class="fn">len</span>(p), <span class="kw">nil</span>
}</div></div>
      <div class="key-points"><ul>
        <li>Interface value = (type, value) pair ‚Äî nil interface kh√°c nil pointer trong interface.</li>
        <li>Empty interface <code>interface{}</code> / <code>any</code> accept m·ªçi type.</li>
        <li>Type assertion: <code>v, ok := i.(ConcreteType)</code> ‚Äî lu√¥n d√πng two-value form ƒë·ªÉ tr√°nh panic.</li>
      </ul></div>
    </div>
  </div>

  <div class="cat-label">Error Handling & Patterns</div>

  <!-- Q7 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">07</span>
      <span class="q-text">Error handling trong Go. Wrap error v√† errors.Is / errors.As d√πng khi n√†o?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Go kh√¥ng c√≥ try/catch. Error l√† value, return c√πng v·ªõi result. Pattern chu·∫©n: <strong>handle error ngay, kh√¥ng ignore.</strong></p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="kw">import</span> <span class="str">"fmt"</span>

<span class="cm">// Wrap ƒë·ªÉ th√™m context</span>
<span class="kw">func</span> <span class="fn">getUser</span>(id <span class="kw">int</span>) (*User, <span class="kw">error</span>) {
    u, err := db.<span class="fn">QueryUser</span>(id)
    <span class="kw">if</span> err != <span class="kw">nil</span> {
        <span class="kw">return</span> <span class="kw">nil</span>, fmt.<span class="fn">Errorf</span>(<span class="str">"getUser %d: %w"</span>, id, err) <span class="cm">// %w wraps</span>
    }
    <span class="kw">return</span> u, <span class="kw">nil</span>
}

<span class="cm">// errors.Is ‚Äî check error chain (sentinel errors)</span>
<span class="kw">if</span> errors.<span class="fn">Is</span>(err, sql.ErrNoRows) { ... }

<span class="cm">// errors.As ‚Äî extract specific error type</span>
<span class="kw">var</span> pgErr *pgconn.PgError
<span class="kw">if</span> errors.<span class="fn">As</span>(err, &amp;pgErr) {
    fmt.<span class="fn">Println</span>(pgErr.Code) <span class="cm">// postgres error code</span>
}</div></div>
      <div class="key-points"><ul>
        <li><code>errors.Is</code>: so s√°nh theo gi√° tr·ªã, traverse error chain qua <code>Unwrap()</code>.</li>
        <li><code>errors.As</code>: check type trong chain, extract ƒë·ªÉ access fields.</li>
        <li>Sentinel error: <code>var ErrNotFound = errors.New("not found")</code> ‚Äî define ·ªü package level.</li>
      </ul></div>
    </div>
  </div>

  <!-- Q8 -->
  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">08</span>
      <span class="q-text">Worker Pool pattern trong Go. T·∫°i sao c·∫ßn gi·ªõi h·∫°n s·ªë goroutine?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Spawn goroutine kh√¥ng gi·ªõi h·∫°n ‚Üí OOM khi load cao. Worker pool gi·ªõi h·∫°n concurrency, t√°i s·ª≠ d·ª•ng goroutines.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="kw">func</span> <span class="fn">workerPool</span>(jobs &lt;-<span class="kw">chan</span> Job, numWorkers <span class="kw">int</span>) {
    <span class="kw">var</span> wg sync.WaitGroup
    
    <span class="kw">for</span> i := <span class="num">0</span>; i &lt; numWorkers; i++ {
        wg.<span class="fn">Add</span>(<span class="num">1</span>)
        <span class="kw">go func</span>() {
            <span class="kw">defer</span> wg.<span class="fn">Done</span>()
            <span class="kw">for</span> job := <span class="kw">range</span> jobs { <span class="cm">// range closes when channel closed</span>
                job.<span class="fn">Process</span>()
            }
        }()
    }
    
    wg.<span class="fn">Wait</span>()
}

<span class="cm">// G·ª≠i jobs</span>
jobs := <span class="fn">make</span>(<span class="kw">chan</span> Job, <span class="num">100</span>)
<span class="kw">go</span> <span class="fn">workerPool</span>(jobs, <span class="num">10</span>) <span class="cm">// ch·ªâ 10 goroutines</span>
<span class="kw">for</span> _, j := <span class="kw">range</span> allJobs { jobs &lt;- j }
<span class="fn">close</span>(jobs) <span class="cm">// signal workers to stop</span></div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Real-world usage</div>
        <p>D√πng semaphore pattern v·ªõi buffered channel: <code>sem := make(chan struct{}, 10)</code>. Acquire: <code>sem &lt;- struct{}{}</code>. Release: <code>&lt;-sem</code>. Ho·∫∑c d√πng <strong>golang.org/x/sync/semaphore</strong>.</p>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECTION: DATABASE -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="sec-db" class="section section-db">
  <div class="section-head">
    <span class="section-num">02</span>
    <h2 class="section-title">Database</h2>
  </div>

  <div class="cat-label">Index & Query Optimization</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">01</span>
      <span class="q-text">Index ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o? B-Tree index vs Hash index?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Index l√† <strong>data structure ph·ª•</strong> gi√∫p database t√¨m rows nhanh m√† kh√¥ng ph·∫£i full table scan (O(n) ‚Üí O(log n)).</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>B-Tree</strong> (default PostgreSQL): balanced tree, h·ªó tr·ª£ range query (<code>&gt;</code>, <code>&lt;</code>, <code>BETWEEN</code>, <code>ORDER BY</code>). Ph√π h·ª£p cho h·∫ßu h·∫øt use case.</li>
        <li><strong>Hash index</strong>: O(1) lookup nh∆∞ng <strong>ch·ªâ h·ªó tr·ª£ equality</strong> (<code>=</code>). Kh√¥ng d√πng ƒë∆∞·ª£c cho range query.</li>
        <li><strong>GIN index</strong>: cho array, JSONB, full-text search. Trong document c·ªßa b·∫°n d√πng cho <code>tags TEXT[]</code>.</li>
        <li><strong>BRIN</strong>: cho d·ªØ li·ªáu c√≥ correlation v·ªõi v·ªã tr√≠ v·∫≠t l√Ω (timestamp tƒÉng d·∫ßn). R·∫•t nh·ªè, ph√π h·ª£p time-series.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† B·∫´y hay g·∫∑p</div>
        <p>Index tr√™n column v·ªõi low cardinality (boolean, gender) th∆∞·ªùng kh√¥ng hi·ªáu qu·∫£ ‚Äî DB optimizer c√≥ th·ªÉ b·ªè qua. Index c≈©ng <strong>l√†m ch·∫≠m INSERT/UPDATE</strong> v√¨ ph·∫£i maintain.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">02</span>
      <span class="q-text">EXPLAIN ANALYZE ƒë·ªçc nh∆∞ th·∫ø n√†o? Seq Scan vs Index Scan?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><code>EXPLAIN ANALYZE</code> th·ª±c thi query v√† tr·∫£ v·ªÅ execution plan v·ªõi actual time. ƒê√¢y l√† c√¥ng c·ª• quan tr·ªçng nh·∫•t ƒë·ªÉ optimize query.</p>
      </div>
      <div class="code-block"><div class="code-block-inner">EXPLAIN ANALYZE
SELECT * FROM watch_sessions
WHERE user_id = <span class="str">'user_123'</span>
AND started_at &gt; NOW() - INTERVAL <span class="str">'30 days'</span>;

<span class="cm">-- Output ƒë·ªçc t·ª´ trong ra ngo√†i (indented = inner first)</span>
<span class="cm">-- Seq Scan: ƒë·ªçc to√†n b·ªô b·∫£ng ‚Üí BAD n·∫øu b·∫£ng l·ªõn</span>
<span class="cm">-- Index Scan: d√πng index ‚Üí GOOD</span>
<span class="cm">-- Index Only Scan: ch·ªâ ƒë·ªçc index, kh√¥ng ƒë·ª•ng table ‚Üí BEST</span>
<span class="cm">-- Bitmap Heap Scan: k·∫øt h·ª£p nhi·ªÅu index conditions</span>

<span class="cm">-- Ch√∫ √Ω: actual time=X..Y rows=Z loops=N</span>
<span class="cm">-- cost=X..Y: estimated, actual time: th·ª±c t·∫ø</span></div></div>
      <div class="key-points"><ul>
        <li>T√¨m node c√≥ <strong>actual time cao nh·∫•t</strong> ‚Äî ƒë√≥ l√† bottleneck.</li>
        <li><strong>rows estimated vs actual</strong> l·ªách nhi·ªÅu ‚Üí c·∫ßn <code>ANALYZE</code> ƒë·ªÉ update statistics.</li>
        <li>Nested Loop Join t·ªët khi dataset nh·ªè. Hash Join t·ªët cho large dataset.</li>
      </ul></div>
    </div>
  </div>

  <div class="cat-label">Transaction & ACID</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">03</span>
      <span class="q-text">ACID l√† g√¨? Isolation levels ‚Äî ƒë·ªçc dirty data, phantom read x·∫£y ra khi n√†o?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>ACID</strong>: Atomicity (all or nothing), Consistency (constraints kh√¥ng b·ªã vi ph·∫°m), Isolation (transactions kh√¥ng th·∫•y nhau), Durability (commit th√¨ persist d√π crash).</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Read Uncommitted</strong>: th·∫•y uncommitted data c·ªßa tx kh√°c ‚Üí <em>Dirty Read</em>. H·∫ßu nh∆∞ kh√¥ng d√πng.</li>
        <li><strong>Read Committed</strong> (PostgreSQL default): ch·ªâ th·∫•y committed data, nh∆∞ng c√≥ th·ªÉ th·∫•y gi√° tr·ªã kh√°c nhau trong c√πng tx ‚Üí <em>Non-repeatable Read</em>.</li>
        <li><strong>Repeatable Read</strong>: snapshot consistent, nh∆∞ng c√≥ th·ªÉ th·∫•y rows m·ªõi ƒë∆∞·ª£c insert ‚Üí <em>Phantom Read</em>.</li>
        <li><strong>Serializable</strong>: ho√†n to√†n isolated, nh∆∞ ch·∫°y serial. Ch·∫≠m nh·∫•t nh∆∞ng safe nh·∫•t.</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">-- PostgreSQL default: Read Committed</span>
BEGIN;
SELECT balance FROM accounts WHERE id = 1;  <span class="cm">-- 100</span>
<span class="cm">-- tx kh√°c UPDATE v√† COMMIT ·ªü ƒë√¢y</span>
SELECT balance FROM accounts WHERE id = 1;  <span class="cm">-- 90 (non-repeatable read!)</span>
COMMIT;

<span class="cm">-- Fix: d√πng Repeatable Read</span>
BEGIN ISOLATION LEVEL REPEATABLE READ;
<span class="cm">-- B√¢y gi·ªù c·∫£ 2 SELECT ƒë·ªÅu tr·∫£ v·ªÅ 100</span></div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Th·ª±c t·∫ø</div>
        <p>PostgreSQL implement Repeatable Read b·∫±ng MVCC ‚Äî kh√¥ng c√≥ Phantom Read. Serializable d√πng SSI (Serializable Snapshot Isolation) ‚Äî hi·ªáu nƒÉng t·ªët h∆°n lock-based.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">04</span>
      <span class="q-text">Deadlock l√† g√¨? L√†m sao ph√≤ng tr√°nh v√† detect?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Deadlock x·∫£y ra khi tx A gi·ªØ lock m√† B c·∫ßn, B gi·ªØ lock m√† A c·∫ßn ‚Üí c·∫£ hai ch·ªù nhau m√£i m√£i.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">-- Tx A                    -- Tx B</span>
BEGIN;                    BEGIN;
UPDATE accounts           UPDATE accounts
  WHERE id = 1;  <span class="cm">-- lock 1</span>   WHERE id = 2; <span class="cm">-- lock 2</span>
UPDATE accounts           UPDATE accounts
  WHERE id = 2;  <span class="cm">-- wait!</span>   WHERE id = 1; <span class="cm">-- wait! DEADLOCK</span></div></div>
      <div class="key-points"><ul>
        <li><strong>Prevention</strong>: lu√¥n lock resources theo th·ª© t·ª± c·ªë ƒë·ªãnh (id tƒÉng d·∫ßn). V√≠ d·ª•: lu√¥n UPDATE id nh·ªè h∆°n tr∆∞·ªõc.</li>
        <li><strong>Detection</strong>: PostgreSQL t·ª± detect v√† kill tx c√≥ cost th·∫•p h∆°n ‚Üí tr·∫£ v·ªÅ error <code>40P01</code>.</li>
        <li><strong>Application level</strong>: retry logic khi nh·∫≠n deadlock error. Keep transactions short.</li>
        <li>Log deadlock: <code>log_lock_waits = on</code>, <code>deadlock_timeout = 1s</code>.</li>
      </ul></div>
    </div>
  </div>

  <div class="cat-label">Scaling & Architecture</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">05</span>
      <span class="q-text">Database sharding l√† g√¨? Khi n√†o d√πng? V·∫•n ƒë·ªÅ g√¨ ph√°t sinh?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Sharding l√† <strong>horizontal partitioning</strong> ‚Äî chia data ra nhi·ªÅu DB servers (shards), m·ªói shard gi·ªØ m·ªôt ph·∫ßn data.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Hash sharding</strong>: <code>shard = hash(user_id) % N</code>. Ph√¢n b·ªï ƒë·ªÅu nh∆∞ng kh√≥ re-shard.</li>
        <li><strong>Range sharding</strong>: shard theo range (user_id 1-1M, 1M-2M...). D·ªÖ hotspot n·∫øu traffic kh√¥ng ƒë·ªÅu.</li>
        <li><strong>Directory sharding</strong>: lookup table ri√™ng ‚Üí flexible nh∆∞ng lookup table l√† SPOF.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† V·∫•n ƒë·ªÅ ph√°t sinh</div>
        <p><strong>Cross-shard queries</strong> r·∫•t kh√≥ ‚Äî JOIN gi·ªØa 2 shards kh√¥ng th·ªÉ d√πng DB level. <strong>Distributed transactions</strong> c·∫ßn 2PC (two-phase commit) ‚Äî ph·ª©c t·∫°p v√† ch·∫≠m. <strong>Rebalancing</strong> khi th√™m shard = di chuy·ªÉn data. Xem x√©t k·ªπ tr∆∞·ªõc khi shard ‚Äî th∆∞·ªùng read replica + caching ƒë·ªß r·ªìi.</p>
      </div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Th·ª© t·ª± scale ƒë√∫ng</div>
        <p>Index optimization ‚Üí Query optimization ‚Üí Connection pooling ‚Üí Read replicas ‚Üí Caching (Redis) ‚Üí Sharding. Sharding l√† b∆∞·ªõc cu·ªëi c√πng, kh√¥ng ph·∫£i ƒë·∫ßu ti√™n.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">06</span>
      <span class="q-text">N+1 query problem l√† g√¨? C√°ch fix?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>N+1 x·∫£y ra khi b·∫°n query 1 l·∫ßn ƒë·ªÉ l·∫•y N records, r·ªìi query th√™m N l·∫ßn cho t·ª´ng record. T·ªïng = N+1 queries.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// BAD ‚Äî N+1: 1 query l·∫•y users + N query l·∫•y orders</span>
users, _ := db.Query(<span class="str">"SELECT * FROM users"</span>)  <span class="cm">// 1</span>
<span class="kw">for</span> _, u := <span class="kw">range</span> users {
    orders, _ := db.Query(                          <span class="cm">// N l·∫ßn!</span>
        <span class="str">"SELECT * FROM orders WHERE user_id=?"</span>, u.ID)
}

<span class="cm">// GOOD ‚Äî JOIN ho·∫∑c IN clause</span>
db.Query(<span class="str">`
    SELECT u.*, o.* FROM users u
    LEFT JOIN orders o ON o.user_id = u.id
`</span>)

<span class="cm">// Ho·∫∑c: l·∫•y t·∫•t c·∫£ user IDs tr∆∞·ªõc, r·ªìi IN query</span>
db.Query(<span class="str">"SELECT * FROM orders WHERE user_id IN (?)"</span>, userIDs...)</div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Trong ORM</div>
        <p>GORM d√πng <code>Preload</code> ho·∫∑c <code>Joins</code> ƒë·ªÉ avoid N+1. Sqlboiler, sqlx c·∫ßn t·ª± vi·∫øt. Lu√¥n check SQL log khi d√πng ORM ƒë·ªÉ ph√°t hi·ªán N+1.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Schema Design & Normalization</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">07</span>
      <span class="q-text">Em c√≥ ·ª©ng d·ª•ng Normalization kh√¥ng? M√¥ t·∫£ 1NF, 2NF, 3NF v√† khi n√†o n√™n Denormalize?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>Normalization</strong> l√† qu√° tr√¨nh t·ªï ch·ª©c database ƒë·ªÉ lo·∫°i b·ªè data redundancy v√† ƒë·∫£m b·∫£o data integrity. Chia th√†nh c√°c Normal Forms (NF).</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>1NF (First Normal Form)</strong>: M·ªói cell ch·ª©a m·ªôt gi√° tr·ªã atomic (kh√¥ng ph·∫£i list/array). M·ªói row l√† unique. V√≠ d·ª• vi ph·∫°m: <code>tags = "golang,redis,kafka"</code> trong 1 column ‚Üí ph·∫£i t√°ch ra b·∫£ng ri√™ng ho·∫∑c d√πng array type.</li>
        <li><strong>2NF</strong>: ƒê·∫°t 1NF + m·ªçi non-key column ph·ª• thu·ªôc v√†o <em>to√†n b·ªô</em> primary key (kh√¥ng ph·∫£i m·ªôt ph·∫ßn). Ch·ªâ √°p d·ª•ng khi PK l√† composite key.</li>
        <li><strong>3NF</strong>: ƒê·∫°t 2NF + kh√¥ng c√≥ transitive dependency ‚Äî column kh√¥ng ƒë∆∞·ª£c ph·ª• thu·ªôc v√†o non-key column kh√°c.</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">-- Vi ph·∫°m 3NF: customer_city ph·ª• thu·ªôc customer_id, kh√¥ng ph·∫£i order_id</span>
orders(order_id, customer_id, customer_name, customer_city)

<span class="cm">-- Sau normalize 3NF: t√°ch th√†nh 2 b·∫£ng</span>
customers(customer_id PK, customer_name, customer_city)
orders(order_id PK, customer_id FK, amount, created_at)
<span class="cm">-- S·ª≠a city c·ªßa customer ‚Üí ch·ªâ update 1 row trong customers</span>
<span class="cm">-- Kh√¥ng c√≤n data redundancy hay inconsistency</span></div></div>
      <div class="ans-label">Khi n√†o n√™n Denormalize?</div>
      <div class="answer-text">
        <p>Denormalize khi <strong>read performance quan tr·ªçng h∆°n write consistency</strong> ‚Äî ch·∫•p nh·∫≠n data redundancy ƒë·ªÉ tr√°nh JOIN ph·ª©c t·∫°p.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Analytics / Reporting</strong>: ClickHouse l∆∞u <code>watch_sessions</code> v·ªõi ƒë·∫ßy ƒë·ªß <code>user_id</code>, <code>video_id</code> tr·ª±c ti·∫øp ‚Äî kh√¥ng JOIN runtime khi query aggregate.</li>
        <li><strong>Read-heavy endpoints</strong>: denormalize <code>author_name</code> v√†o b·∫£ng <code>posts</code> n·∫øu 99% query l√† read, author hi·∫øm khi ƒë·ªïi t√™n.</li>
        <li><strong>ƒê√°nh ƒë·ªïi</strong>: update ph·ª©c t·∫°p h∆°n (ph·∫£i update nhi·ªÅu ch·ªó), data c√≥ th·ªÉ stale n·∫øu kh√¥ng sync k·ªãp.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Quy t·∫Øc th·ª±c chi·∫øn</div>
        <p>Normalize tr∆∞·ªõc ƒë·ªÉ ƒë·∫£m b·∫£o correctness. Denormalize sau khi c√≥ <strong>evidence t·ª´ profiling</strong> ‚Äî ƒë·ª´ng denormalize s·ªõm v√¨ "nghƒ© l√† s·∫Ω ch·∫≠m". M·ªói quy·∫øt ƒë·ªãnh denormalize c·∫ßn document l√Ω do ƒë·ªÉ team hi·ªÉu t·∫°i sao schema tr√¥ng "l·∫°".</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">08</span>
      <span class="q-text">Em ƒë√£ t·ª´ng thi·∫øt k·∫ø database ch∆∞a? Em thi·∫øt k·∫ø nh∆∞ th·∫ø n√†o? T·∫°i sao ch·ªçn database ƒë√≥?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi ‚Äî Polyglot Persistence mindset</div>
      <div class="answer-text">
        <p>C√≥. M√¨nh kh√¥ng d√πng m·ªôt lo·∫°i DB cho t·∫•t c·∫£ ‚Äî m·ªói lo·∫°i DB c√≥ <strong>strength ri√™ng, ph√π h·ª£p v·ªõi access pattern kh√°c nhau</strong>. Quy·∫øt ƒë·ªãnh "d√πng DB n√†o" quan tr·ªçng kh√¥ng k√©m thi·∫øt k·∫ø schema.</p>
      </div>
      <div class="ans-label">Decision Framework ‚Äî khi n√†o d√πng g√¨</div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// PostgreSQL ‚Äî transactional, relational, ACID critical</span>
<span class="cm">// D√πng khi: user data, orders, payments, anything c·∫ßn FK + constraint</span>
users(user_id PK, email UNIQUE, created_at, engagement_score)
videos(video_id PK, creator_id FK, category, tags GIN_INDEX)
<span class="cm">// Strength: JOIN, transaction, constraint, mature ecosystem</span>
<span class="cm">// Weakness: kh√¥ng scale write t·ªët ·ªü very high volume</span>

<span class="cm">// Redis ‚Äî sub-millisecond, in-memory, data structures phong ph√∫</span>
<span class="cm">// D√πng khi: cache, session, rate limit, leaderboard, pub/sub</span>
feed_pool:{user_id}  ‚Üí LIST    (200 video IDs, TTL 1h)
session:{user_id}    ‚Üí STRING  (cursor JSON, TTL 30m)
rate_limit:{ip}      ‚Üí STRING  (counter + INCR, TTL 1m)
leaderboard          ‚Üí SORTED SET (score ‚Üí userID)
<span class="cm">// Strength: c·ª±c nhanh &lt;1ms, atomic ops, TTL built-in</span>
<span class="cm">// Weakness: volatile, kh√¥ng ph·∫£i primary store, memory gi·ªõi h·∫°n</span>

<span class="cm">// ClickHouse ‚Äî columnar analytics, time-series, aggregation</span>
<span class="cm">// D√πng khi: event tracking, metrics, reporting v·ªõi billions of rows</span>
playback_events ENGINE = MergeTree()
  PARTITION BY toYYYYMM(created_at)
  ORDER BY (user_id, created_at)
<span class="cm">// Strength: columnar storage, compression 10x, GROUP BY r·∫•t nhanh</span>
<span class="cm">// Weakness: kh√¥ng ph√π h·ª£p OLTP, UPDATE/DELETE ph·ª©c t·∫°p, eventual consistency</span>

<span class="cm">// MongoDB ‚Äî flexible schema, document-oriented, nested data</span>
<span class="cm">// D√πng khi: content v·ªõi schema hay thay ƒë·ªïi, deeply nested objects</span>
{ "_id": "video_123",
  "metadata": { "title": "...", "tags": [...] },
  "captions": [{ "lang": "vi", "url": "..." }],   <span class="cm">// nested, vary per doc</span>
  "custom_fields": { "platform": "tiktok" } }      <span class="cm">// flexible schema</span>
<span class="cm">// Strength: flexible schema, horizontal scale (sharding built-in)</span>
<span class="cm">// Weakness: no JOIN across collections, no multi-doc ACID (tr∆∞·ªõc v4.0)</span></div></div>

      <div class="ans-label">Quy tr√¨nh thi·∫øt k·∫ø schema th·ª±c t·∫ø</div>
      <div class="key-points"><ul>
        <li><strong>1. X√°c ƒë·ªãnh access patterns tr∆∞·ªõc</strong>: "Query g√¨ ch·∫°y nhi·ªÅu nh·∫•t? Filter g√¨? Join b·∫£ng n√†o? Read/write ratio?" ‚Äî Schema ph·ª•c v·ª• access pattern, kh√¥ng ph·∫£i ng∆∞·ª£c l·∫°i.</li>
        <li><strong>2. Ch·ªçn ƒë√∫ng DB type</strong> d·ª±a tr√™n framework ·ªü tr√™n ‚Äî kh√¥ng d√πng PostgreSQL cho m·ªçi th·ª©.</li>
        <li><strong>3. Normalize ƒë·∫øn 3NF</strong> cho relational DB, sau ƒë√≥ denormalize c√≥ ch·ªß ƒë√≠ch n·∫øu c·∫ßn.</li>
        <li><strong>4. Thi·∫øt k·∫ø index song song v·ªõi schema</strong>: composite index cho multi-column WHERE, GIN cho array/JSONB, partial index cho filtered queries.</li>
        <li><strong>5. Estimate volume v√† growth</strong>: 1M users √ó 20 events/day = 20M rows/day ‚Üí c·∫ßn partition strategy, TTL policy.</li>
        <li><strong>6. Migration strategy</strong>: backward-compatible ‚Äî kh√¥ng DROP COLUMN ngay, rename + deprecate, double-write khi zero-downtime c·∫ßn thi·∫øt.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° C√¢u tr·∫£ l·ªùi t·∫°o ƒëi·ªÉm nh·∫•n v·ªõi interviewer</div>
        <p>"PostgreSQL l√†m source of truth cho user/video metadata v√¨ c·∫ßn ACID v√† FK. Redis cho feed pool v√† session ‚Äî sub-millisecond, kh√¥ng c·∫ßn persistent. ClickHouse cho event analytics ‚Äî write throughput cao, aggregate query c·ª±c nhanh. MongoDB cho content v·ªõi schema linh ho·∫°t. M·ªói l·ª±a ch·ªçn d·ª±a tr√™n <strong>access pattern v√† consistency requirement</strong> ‚Äî kh√¥ng ph·∫£i preference hay trend."</p>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECTION: MESSAGE BROKER -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="sec-kafka" class="section section-kafka">
  <div class="section-head">
    <span class="section-num">03</span>
    <h2 class="section-title">Message Broker</h2>
  </div>

  <div class="cat-label">Kafka Fundamentals</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">01</span>
      <span class="q-text">Kafka architecture: Topic, Partition, Consumer Group ho·∫°t ƒë·ªông th·∫ø n√†o?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Kafka l√† <strong>distributed commit log</strong>. Messages ƒë∆∞·ª£c ghi v√†o topics, consume b·ªüi consumer groups.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Topic</strong>: category/feed t√™n cho messages. Durable, append-only log.</li>
        <li><strong>Partition</strong>: topic chia th√†nh N partitions ‚Äî ƒë∆°n v·ªã parallelism. Messages trong 1 partition c√≥ order guarantee.</li>
        <li><strong>Consumer Group</strong>: m·ªói partition ƒë∆∞·ª£c assign cho ƒë√∫ng 1 consumer trong group. Cho ph√©p scale horizontally. 2 groups ƒë·ªçc c√πng topic = 2 l·∫ßn (broadcast).</li>
        <li><strong>Offset</strong>: position c·ªßa consumer trong partition. Consumer t·ª± qu·∫£n l√Ω offset ‚Üí c√≥ th·ªÉ re-read.</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Rule: consumers trong group ‚â§ s·ªë partitions</span>
<span class="cm">// 10 partitions + 5 consumers = m·ªói consumer 2 partitions</span>
<span class="cm">// 10 partitions + 10 consumers = m·ªói consumer 1 partition  ‚Üê optimal</span>
<span class="cm">// 10 partitions + 15 consumers = 5 consumers idle ‚Üê l√£ng ph√≠</span></div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Partition key</div>
        <p>Messages c√πng key ‚Üí c√πng partition ‚Üí ordered. V√≠ d·ª•: key=user_id ‚Üí m·ªçi event c·ªßa user ƒë√≥ theo th·ª© t·ª±. N·∫øu kh√¥ng set key ‚Üí round-robin distribution.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">02</span>
      <span class="q-text">At-least-once vs At-most-once vs Exactly-once delivery. Kafka ƒë·∫£m b·∫£o c√°i n√†o?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>ƒê√¢y l√† c√¢u h·ªèi c·ª±c k·ª≥ ph·ªï bi·∫øn. Ba delivery semantics:</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>At-most-once</strong>: commit offset tr∆∞·ªõc khi process ‚Üí n·∫øu crash gi·ªØa ch·ª´ng, message m·∫•t. Kh√¥ng c√≥ duplicate nh∆∞ng c√≥ th·ªÉ m·∫•t data. D√πng cho: logs, metrics kh√¥ng quan tr·ªçng.</li>
        <li><strong>At-least-once</strong>: commit offset sau khi process th√†nh c√¥ng ‚Üí n·∫øu crash, re-process. C√≥ duplicate nh∆∞ng kh√¥ng m·∫•t data. C·∫ßn <strong>idempotent consumer</strong>. D√πng cho h·∫ßu h·∫øt use case.</li>
        <li><strong>Exactly-once</strong>: Kafka h·ªó tr·ª£ qua Idempotent Producer + Transactional API. Ph·ª©c t·∫°p v√† c√≥ overhead. D√πng cho financial transactions.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† Idempotent consumer</div>
        <p>V·ªõi at-least-once, consumer ph·∫£i handle duplicate: d√πng unique message ID, check trong DB tr∆∞·ªõc khi process. V√≠ d·ª•: <code>INSERT ... ON CONFLICT DO NOTHING</code> v·ªõi message_id l√†m unique key.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">03</span>
      <span class="q-text">Consumer lag l√† g√¨? L√†m sao monitor v√† fix khi lag tƒÉng?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p><strong>Consumer lag</strong> = log end offset ‚àí consumer committed offset. Nghƒ©a l√†: s·ªë messages ch∆∞a ƒë∆∞·ª£c x·ª≠ l√Ω. Lag tƒÉng = consumer x·ª≠ l√Ω ch·∫≠m h∆°n producer produce.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Monitor</strong>: <code>kafka-consumer-groups.sh --describe</code> ho·∫∑c Kafka UI, Grafana + JMX.</li>
        <li><strong>Root cause</strong>: consumer x·ª≠ l√Ω ch·∫≠m (heavy DB query), downstream service slow, consumer crash/rebalancing li√™n t·ª•c.</li>
        <li><strong>Fix</strong>: tƒÉng s·ªë consumer (th√™m instance, tƒÉng partition n·∫øu c·∫ßn), t·ªëi ∆∞u processing logic, t√°ch slow consumer ra topic ri√™ng.</li>
        <li><strong>Backpressure</strong>: pause consumer khi downstream full, resume khi drain xong.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Trong h·ªá th·ªëng c·ªßa b·∫°n</div>
        <p>ClickHouse consumer ghi batch 1000 events ‚Üí n·∫øu ClickHouse slow ho·∫∑c overload, lag tƒÉng. Gi·∫£i ph√°p: tƒÉng batch size, d√πng async insert c·ªßa ClickHouse, ho·∫∑c th√™m consumer instances.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Kafka vs RabbitMQ & Design</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">04</span>
      <span class="q-text">Kafka vs RabbitMQ ‚Äî ch·ªçn c√°i n√†o? Khi n√†o d√πng c√°i n√†o?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>ƒê√¢y l√† c√¢u h·ªèi ph·ªèng v·∫•n r·∫•t ph·ªï bi·∫øn. C·∫ßn so s√°nh theo use case, kh√¥ng ph·∫£i "c√°i n√†o t·ªët h∆°n".</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Kafka</strong>: d√πng khi c·∫ßn high throughput (millions msg/s), retention d√†i, replay messages, event streaming, multiple consumers ƒë·ªçc c√πng data, audit log. <em>H·ªá th·ªëng c·ªßa b·∫°n d√πng ƒë√∫ng ch·ªó</em>.</li>
        <li><strong>RabbitMQ</strong>: d√πng khi c·∫ßn routing ph·ª©c t·∫°p (exchanges, bindings), task queue (message xong th√¨ x√≥a), low latency, priority queues, RPC pattern.</li>
        <li><strong>Kafka KH√îNG ph·∫£i</strong> task queue t·ªët ‚Äî messages kh√¥ng x√≥a sau khi consumed, kh√¥ng c√≥ per-message ACK nh∆∞ RabbitMQ.</li>
        <li><strong>RabbitMQ KH√îNG t·ªët</strong> cho event sourcing ‚Äî kh√¥ng c√≥ replay, kh√¥ng c√≥ long retention.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° C√¢u tr·∫£ l·ªùi g√¢y ·∫•n t∆∞·ª£ng</div>
        <p>"Kafka l√† log, RabbitMQ l√† queue. Kafka ph√π h·ª£p khi b·∫°n mu·ªën nhi·ªÅu consumer ƒë·ªçc c√πng event stream (fan-out). RabbitMQ ph√π h·ª£p khi c√≥ competing consumers c√πng x·ª≠ l√Ω 1 job v√† message ƒë∆∞·ª£c acknowledge khi xong."</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">05</span>
      <span class="q-text">Kafka replication v√† acks=all ‚Äî ƒë·∫£m b·∫£o durability th·∫ø n√†o?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Kafka replicate partitions sang nhi·ªÅu brokers ƒë·ªÉ fault tolerance. Leader nh·∫≠n writes, followers sync t·ª´ leader.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>acks=0</strong>: fire-and-forget. Producer kh√¥ng ƒë·ª£i ack. Nhanh nh·∫•t, c√≥ th·ªÉ m·∫•t data.</li>
        <li><strong>acks=1</strong>: leader ghi xong l√† ACK. N·∫øu leader crash tr∆∞·ªõc khi replicate ‚Üí m·∫•t data.</li>
        <li><strong>acks=all (-1)</strong>: ƒë·ª£i t·∫•t c·∫£ ISR (In-Sync Replicas) ghi xong. Ch·∫≠m nh·∫•t nh∆∞ng kh√¥ng m·∫•t data. D√πng k√®m <code>min.insync.replicas=2</code>.</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Producer config cho durability cao</span>
producer := kafka.NewWriter(kafka.WriterConfig{
    Brokers:      []string{<span class="str">"kafka:9092"</span>},
    Topic:        <span class="str">"video-events"</span>,
    RequiredAcks: kafka.RequireAll,    <span class="cm">// acks=all</span>
    Async:        <span class="kw">false</span>,              <span class="cm">// synchronous</span>
    MaxAttempts:  <span class="num">3</span>,                 <span class="cm">// retry</span>
})</div></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† Idempotent Producer</div>
        <p>Retry c√≥ th·ªÉ g√¢y duplicate messages. Enable <code>enable.idempotence=true</code> ‚Üí Kafka assign sequence number cho m·ªói message, broker dedup t·ª± ƒë·ªông. B·∫Øt bu·ªôc n·∫øu d√πng acks=all + retry.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">06</span>
      <span class="q-text">Outbox Pattern l√† g√¨? T·∫°i sao c·∫ßn khi d√πng Kafka v·ªõi database?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>V·∫•n ƒë·ªÅ: b·∫°n c·∫ßn v·ª´a ghi DB v·ª´a publish Kafka trong c√πng 1 operation. N·∫øu DB th√†nh c√¥ng nh∆∞ng Kafka fail ‚Üí inconsistency.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// BAD ‚Äî kh√¥ng atomic</span>
<span class="kw">func</span> <span class="fn">createOrder</span>(order Order) <span class="kw">error</span> {
    db.<span class="fn">Insert</span>(order)               <span class="cm">// OK</span>
    kafka.<span class="fn">Publish</span>(<span class="str">"order.created"</span>) <span class="cm">// FAIL ‚Üí inconsistent!</span>
}

<span class="cm">// GOOD ‚Äî Outbox Pattern</span>
<span class="cm">// 1. Ghi order + outbox message trong C√ôNG DB transaction</span>
tx.<span class="fn">Insert</span>(order)
tx.<span class="fn">Insert</span>(<span class="str">"outbox"</span>, {event: <span class="str">"order.created"</span>, payload: order})
tx.<span class="fn">Commit</span>()

<span class="cm">// 2. Separate process ƒë·ªçc outbox table ‚Üí publish Kafka</span>
<span class="cm">// N·∫øu publish fail ‚Üí retry (outbox row v·∫´n c√≤n)</span>
<span class="cm">// N·∫øu publish th√†nh c√¥ng ‚Üí delete ho·∫∑c mark processed</span>

<span class="cm">// CDC: d√πng Debezium watch binlog ‚Üí auto publish Kafka</span></div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Tri·ªÉn khai th·ª±c t·∫ø</div>
        <p><strong>Polling publisher</strong>: cronjob ƒë·ªçc outbox table m·ªói v√†i gi√¢y. ƒê∆°n gi·∫£n nh∆∞ng c√≥ latency.<br><strong>CDC (Change Data Capture)</strong>: Debezium ƒë·ªçc PostgreSQL WAL ‚Üí publish Kafka. Real-time, kh√¥ng polling, nh∆∞ng c·∫ßn setup th√™m.</p>
      </div>
    </div>
  </div>
  <div class="cat-label">RabbitMQ</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">07</span>
      <span class="q-text">RabbitMQ l√† g√¨? X·ª≠ l√Ω l·ªói trong RabbitMQ nh∆∞ th·∫ø n√†o?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>RabbitMQ l√† <strong>message broker</strong> implement giao th·ª©c AMQP. Ho·∫°t ƒë·ªông theo m√¥ h√¨nh <strong>Producer ‚Üí Exchange ‚Üí Queue ‚Üí Consumer</strong>. Exchange l√† ƒëi·ªÉm routing ‚Äî quy·∫øt ƒë·ªãnh message ƒëi v√†o queue n√†o d·ª±a tr√™n routing rules.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// 4 lo·∫°i Exchange:</span>
<span class="cm">// Direct:  route theo exact routing key</span>
<span class="cm">// Fanout:  broadcast ƒë·∫øn t·∫•t c·∫£ queues (ignore key)</span>
<span class="cm">// Topic:   route theo pattern (*.error, logs.#)</span>
<span class="cm">// Headers: route theo message headers</span>

<span class="cm">// Consumer ACK flow</span>
msg, _ := ch.<span class="fn">Consume</span>(queue, <span class="str">""</span>, <span class="kw">false</span>, ...) <span class="cm">// autoAck=false</span>
<span class="kw">for</span> d := <span class="kw">range</span> msg {
    err := <span class="fn">processMessage</span>(d.Body)
    <span class="kw">if</span> err != <span class="kw">nil</span> {
        d.<span class="fn">Nack</span>(<span class="kw">false</span>, <span class="kw">true</span>)  <span class="cm">// requeue=true: ƒë∆∞a l·∫°i queue</span>
        <span class="cm">// ho·∫∑c Nack(false, false) ‚Üí dead letter queue</span>
    } <span class="kw">else</span> {
        d.<span class="fn">Ack</span>(<span class="kw">false</span>)         <span class="cm">// acknowledge: x√≥a kh·ªèi queue</span>
    }
}</div></div>
      <div class="key-points"><ul>
        <li><strong>ACK (Acknowledge)</strong>: consumer b√°o ƒë√£ x·ª≠ l√Ω th√†nh c√¥ng ‚Üí RabbitMQ x√≥a message.</li>
        <li><strong>NACK / Reject</strong>: x·ª≠ l√Ω th·∫•t b·∫°i ‚Üí c√≥ th·ªÉ requeue ho·∫∑c g·ª≠i v√†o Dead Letter Exchange (DLX).</li>
        <li><strong>Dead Letter Queue (DLQ)</strong>: n∆°i ch·ª©a messages b·ªã reject, expired, ho·∫∑c queue overflow. D√πng ƒë·ªÉ debug, manual retry.</li>
        <li><strong>Retry v·ªõi exponential backoff</strong>: d√πng per-message TTL + DLX ‚Üí sau N gi√¢y t·ª± ƒë·ªông republish l·∫°i queue g·ªëc.</li>
        <li><strong>Persistent message</strong>: <code>DeliveryMode: 2</code> ‚Üí RabbitMQ ghi xu·ªëng disk, kh√¥ng m·∫•t khi restart.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† B·∫´y ph·ªï bi·∫øn</div>
        <p><strong>Poison message</strong>: message lu√¥n fail ‚Üí li√™n t·ª•c requeue ‚Üí loop v√¥ h·∫°n ‚Üí consumer b·ªã lock. Gi·∫£i ph√°p: ƒë·∫øm retry count (d√πng <code>x-death</code> header), sau N l·∫ßn chuy·ªÉn v√†o DLQ thay v√¨ requeue.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">08</span>
      <span class="q-text">T·∫°i sao d√πng RabbitMQ? ∆Øu ƒëi·ªÉm so v·ªõi g·ªçi API tr·ª±c ti·∫øp?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>RabbitMQ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ <strong>coupling v√† reliability</strong> trong communication gi·ªØa c√°c services.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Decoupling</strong>: Producer kh√¥ng c·∫ßn bi·∫øt Consumer c√≥ ƒëang ch·∫°y kh√¥ng. G·ª≠i v√†o queue ‚Üí xong. Consumer c√≥ th·ªÉ down, restart m√† kh√¥ng m·∫•t message.</li>
        <li><strong>Async processing</strong>: request n·∫∑ng (send email, resize image, generate report) x·ª≠ l√Ω background ‚Äî user kh√¥ng ph·∫£i ƒë·ª£i.</li>
        <li><strong>Load leveling</strong>: producer spike 10,000 requests/s nh∆∞ng consumer x·ª≠ l√Ω ·ªïn ƒë·ªãnh 1,000/s ‚Äî queue l√†m buffer, kh√¥ng l√†m ch·∫øt downstream.</li>
        <li><strong>Retry built-in</strong>: message fail t·ª± ƒë·ªông retry, kh√¥ng c·∫ßn t·ª± code retry logic ·ªü application.</li>
        <li><strong>Fan-out</strong>: 1 event ‚Üí nhi·ªÅu consumers x·ª≠ l√Ω song song (fanout exchange). V√≠ d·ª•: user ƒëƒÉng k√Ω ‚Üí g·ª≠i email + t·∫°o profile + notify analytics.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° So s√°nh tr·ª±c ti·∫øp</div>
        <p><strong>HTTP sync call</strong>: Service A g·ªçi B ‚Äî n·∫øu B ch·∫≠m, A b·ªã block. N·∫øu B down, A l·ªói. Tight coupling.<br><strong>RabbitMQ async</strong>: A g·ª≠i message, kh√¥ng quan t√¢m B. B t·ª± x·ª≠ l√Ω khi s·∫µn s√†ng. Loose coupling, resilient h∆°n.</p>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECTION: ARCHITECTURE & SECURITY -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="sec-arch" class="section section-arch">
  <div class="section-head">
    <span class="section-num">04</span>
    <h2 class="section-title">Architecture & Security</h2>
  </div>

  <div class="cat-label">API Security</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">01</span>
      <span class="q-text">L√†m th·∫ø n√†o ƒë·ªÉ b·∫£o m·∫≠t API? K·ªÉ c√°c l·ªõp b·∫£o m·∫≠t m·ªôt senior backend c·∫ßn bi·∫øt.</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>API security l√† multi-layer ‚Äî kh√¥ng c√≥ m·ªôt gi·∫£i ph√°p duy nh·∫•t. Ti·∫øp c·∫≠n theo <strong>Defense in Depth</strong>: nhi·ªÅu l·ªõp b·∫£o v·ªá, n·∫øu m·ªôt l·ªõp b·ªã qua th√¨ c√≤n l·ªõp kh√°c.</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>Authentication</strong>: x√°c minh identity. D√πng JWT, OAuth2, API Key. Lu√¥n d√πng HTTPS ‚Äî kh√¥ng bao gi·ªù g·ª≠i token qua HTTP plain.</li>
        <li><strong>Authorization</strong>: x√°c minh permission. RBAC (Role-Based) ho·∫∑c ABAC (Attribute-Based). Validate ·ªü middleware tr∆∞·ªõc khi v√†o handler.</li>
        <li><strong>Input Validation</strong>: validate v√† sanitize m·ªçi input. Ph√≤ng SQL injection, XSS, path traversal. D√πng parameterized query ‚Äî kh√¥ng bao gi·ªù string concat SQL.</li>
        <li><strong>Rate Limiting</strong>: gi·ªõi h·∫°n request per IP/user. Ph√≤ng brute force, DDoS. D√πng sliding window ho·∫∑c token bucket.</li>
        <li><strong>CORS</strong>: ch·ªâ allow trusted origins. Kh√¥ng ƒë·ªÉ <code>Access-Control-Allow-Origin: *</code> cho authenticated endpoints.</li>
        <li><strong>Sensitive data</strong>: kh√¥ng log password, token, PII. Mask trong response. Encrypt at rest (password bcrypt, sensitive fields AES).</li>
        <li><strong>Security headers</strong>: <code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>Strict-Transport-Security</code>.</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Go middleware stack th·ª±c t·∫ø</span>
router.<span class="fn">Use</span>(
    middleware.<span class="fn">RateLimit</span>(<span class="num">100</span>, time.Minute),   <span class="cm">// 100 req/min</span>
    middleware.<span class="fn">CORS</span>(allowedOrigins),
    middleware.<span class="fn">SecurityHeaders</span>(),
    middleware.<span class="fn">Authenticate</span>(jwtSecret),    <span class="cm">// verify JWT</span>
    middleware.<span class="fn">Authorize</span>(requiredRoles...),  <span class="cm">// check permission</span>
    middleware.<span class="fn">RequestLogger</span>(),             <span class="cm">// log (mask sensitive)</span>
)</div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° ƒêi·ªÉm c·ªông ‚Äî OWASP Top 10</div>
        <p>Mention <strong>OWASP API Security Top 10</strong>: Broken Object Level Authorization (BOLA) l√† l·ªói ph·ªï bi·∫øn nh·∫•t ‚Äî user A c√≥ th·ªÉ access data c·ªßa user B b·∫±ng c√°ch thay ƒë·ªïi ID trong request. Fix: lu√¥n validate <code>resource.user_id == currentUser.id</code>.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">02</span>
      <span class="q-text">JWT ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o? T·∫°i sao refresh token c√≥ th·ªùi h·∫°n d√†i h∆°n access token?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>JWT (JSON Web Token) l√† <strong>stateless token</strong> g·ªìm 3 ph·∫ßn: <code>Header.Payload.Signature</code>, encode b·∫±ng Base64URL v√† k√Ω b·∫±ng secret key (HMAC) ho·∫∑c private key (RSA/ES256).</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Structure: base64(header).base64(payload).signature</span>
<span class="cm">// Header: {"alg":"HS256","typ":"JWT"}</span>
<span class="cm">// Payload: {"sub":"user_123","role":"admin","exp":1706745600}</span>
<span class="cm">// Signature: HMACSHA256(header+"."+payload, secret)</span>

<span class="cm">// Verify: server t·ª± t√≠nh l·∫°i signature ‚Üí so s√°nh</span>
<span class="cm">// Kh√¥ng c·∫ßn query DB m·ªói request ‚Üí stateless, scalable</span>

<span class="cm">// Go implementation</span>
claims := jwt.MapClaims{
    <span class="str">"sub"</span>: userID,
    <span class="str">"exp"</span>: time.<span class="fn">Now</span>().<span class="fn">Add</span>(<span class="num">15</span> * time.Minute).<span class="fn">Unix</span>(), <span class="cm">// access: 15m</span>
}
token := jwt.<span class="fn">NewWithClaims</span>(jwt.SigningMethodHS256, claims)
signed, _ := token.<span class="fn">SignedString</span>([]<span class="kw">byte</span>(secret))</div></div>
      <div class="key-points"><ul>
        <li><strong>Access token ng·∫Øn (15 ph√∫t)</strong>: v√¨ JWT <strong>kh√¥ng th·ªÉ revoke</strong> tr∆∞·ªõc khi h·∫øt h·∫°n (stateless). N·∫øu b·ªã steal, attacker ch·ªâ d√πng ƒë∆∞·ª£c t·ªëi ƒëa 15 ph√∫t.</li>
        <li><strong>Refresh token d√†i (7-30 ng√†y)</strong>: l∆∞u trong DB (c√≥ th·ªÉ revoke b·∫•t c·ª© l√∫c n√†o). Ch·ªâ d√πng 1 l·∫ßn ƒë·ªÉ l·∫•y access token m·ªõi. L∆∞u ·ªü httpOnly cookie ‚Äî JavaScript kh√¥ng ƒë·ªçc ƒë∆∞·ª£c ‚Üí ph√≤ng XSS.</li>
        <li><strong>Rotation</strong>: m·ªói l·∫ßn d√πng refresh token ‚Üí ph√°t token m·ªõi + invalidate token c≈© (refresh token rotation). Ph√°t hi·ªán token reuse ‚Üí logout to√†n b·ªô sessions.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† B·∫´y JWT ph·ªï bi·∫øn</div>
        <p><strong>alg=none attack</strong>: attacker set <code>"alg":"none"</code> ‚Üí kh√¥ng c√≥ signature ‚Üí bypass verify. Fix: lu√¥n whitelist algorithms ƒë∆∞·ª£c ph√©p. Kh√¥ng d√πng <code>jwt.Parse</code> m√† kh√¥ng validate alg.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Design Patterns ‚Äî T·ª± tin nh·∫•t</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">03</span>
      <span class="q-text">Repository Pattern ‚Äî m√¥ t·∫£, implement trong Go, v√† l·ª£i √≠ch th·ª±c t·∫ø?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">ƒê·ªãnh nghƒ©a</div>
      <div class="answer-text">
        <p>Repository Pattern t√°ch bi·ªát <strong>business logic kh·ªèi data access logic</strong> b·∫±ng c√°ch ƒë·ªãnh nghƒ©a interface tr·ª´u t∆∞·ª£ng cho vi·ªác persist/retrieve domain objects. Business layer ch·ªâ bi·∫øt interface ‚Äî kh√¥ng bi·∫øt Postgres, MongoDB hay Redis t·ªìn t·∫°i.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ STEP 1: Domain layer ƒë·ªãnh nghƒ©a interface ‚îÄ‚îÄ</span>
<span class="cm">// File: internal/domain/repository/user_repository.go</span>
<span class="kw">type</span> UserRepository <span class="kw">interface</span> {
    <span class="fn">FindByID</span>(ctx context.Context, id string) (*entity.User, <span class="kw">error</span>)
    <span class="fn">FindByEmail</span>(ctx context.Context, email string) (*entity.User, <span class="kw">error</span>)
    <span class="fn">Save</span>(ctx context.Context, user *entity.User) <span class="kw">error</span>
    <span class="fn">Delete</span>(ctx context.Context, id string) <span class="kw">error</span>
    <span class="fn">ListByIDs</span>(ctx context.Context, ids []string) ([]*entity.User, <span class="kw">error</span>)
}

<span class="cm">// ‚îÄ‚îÄ STEP 2: Infrastructure implement v·ªõi Postgres ‚îÄ‚îÄ</span>
<span class="cm">// File: internal/infrastructure/postgres/user_pg_repo.go</span>
<span class="kw">type</span> userPostgresRepo <span class="kw">struct</span> {
    db  *sqlx.DB
    log *zap.Logger
}

<span class="kw">func</span> NewUserPostgresRepo(db *sqlx.DB, log *zap.Logger) UserRepository {
    <span class="kw">return</span> &amp;userPostgresRepo{db: db, log: log}
}

<span class="kw">func</span> (r *userPostgresRepo) FindByID(ctx context.Context, id string) (*entity.User, <span class="kw">error</span>) {
    <span class="kw">var</span> row userRow
    err := r.db.GetContext(ctx, &amp;row,
        <span class="str">"SELECT * FROM users WHERE user_id = $1 AND deleted_at IS NULL"</span>, id)
    <span class="kw">if</span> errors.Is(err, sql.ErrNoRows) {
        <span class="kw">return</span> <span class="kw">nil</span>, domain.ErrUserNotFound <span class="cm">// translate DB error ‚Üí domain error</span>
    }
    <span class="kw">return</span> row.toDomain(), err
}

<span class="cm">// ‚îÄ‚îÄ STEP 3: Redis implement c√πng interface (cache layer) ‚îÄ‚îÄ</span>
<span class="kw">type</span> userRedisRepo <span class="kw">struct</span> {
    rdb      *redis.Client
    fallback UserRepository  <span class="cm">// delegate to postgres n·∫øu cache miss</span>
    ttl      time.Duration
}

<span class="kw">func</span> (r *userRedisRepo) FindByID(ctx context.Context, id string) (*entity.User, <span class="kw">error</span>) {
    cached, err := r.rdb.Get(ctx, <span class="str">"user:"</span>+id).Result()
    <span class="kw">if</span> err == <span class="kw">nil</span> {
        <span class="kw">return</span> unmarshal(cached), <span class="kw">nil</span> <span class="cm">// cache hit</span>
    }
    user, err := r.fallback.FindByID(ctx, id) <span class="cm">// cache miss ‚Üí postgres</span>
    <span class="kw">if</span> err != <span class="kw">nil</span> { <span class="kw">return</span> <span class="kw">nil</span>, err }
    r.rdb.Set(ctx, <span class="str">"user:"</span>+id, marshal(user), r.ttl)
    <span class="kw">return</span> user, <span class="kw">nil</span>
}

<span class="cm">// ‚îÄ‚îÄ STEP 4: Usecase inject interface ‚Äî kh√¥ng bi·∫øt g√¨ v·ªÅ DB ‚îÄ‚îÄ</span>
<span class="kw">type</span> UserUsecase <span class="kw">struct</span> {
    userRepo UserRepository  <span class="cm">// interface, kh√¥ng ph·∫£i concrete type</span>
}

<span class="kw">func</span> NewUserUsecase(repo UserRepository) *UserUsecase {
    <span class="kw">return</span> &amp;UserUsecase{userRepo: repo}
}

<span class="cm">// ‚îÄ‚îÄ STEP 5: Wire trong main.go ‚îÄ‚îÄ</span>
pgRepo    := postgres.NewUserPostgresRepo(db, log)
cachedRepo := redis.NewUserRedisRepo(rdb, pgRepo, time.Hour)
usecase   := usecase.NewUserUsecase(cachedRepo) <span class="cm">// swap b·∫•t c·ª© l√∫c n√†o</span></div></div>

      <div class="key-points"><ul>
        <li><strong>Testability</strong>: unit test usecase v·ªõi mock repository ‚Äî kh√¥ng c·∫ßn spin up Postgres.</li>
        <li><strong>Cache decorator</strong>: Redis repo wrap Postgres repo ‚Äî c√πng interface, th√™m caching layer m√† kh√¥ng thay ƒë·ªïi usecase.</li>
        <li><strong>Error translation</strong>: repo chuy·ªÉn <code>sql.ErrNoRows</code> th√†nh <code>domain.ErrNotFound</code> ‚Äî usecase ch·ªâ bi·∫øt domain errors.</li>
        <li><strong>Swap DB</strong>: migrate t·ª´ Postgres sang CockroachDB ‚Äî ch·ªâ c·∫ßn vi·∫øt impl m·ªõi, usecase kh√¥ng ƒë·ªïi 1 d√≤ng.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Senior-level detail: t·∫°i sao translate error?</div>
        <p>N·∫øu ƒë·ªÉ <code>sql.ErrNoRows</code> leak l√™n usecase ‚Üí usecase b·ªã ph·ª• thu·ªôc v√†o <code>database/sql</code> package. ƒê√¢y l√† vi ph·∫°m Dependency Rule. Domain errors nh∆∞ <code>ErrUserNotFound</code> l√† part of domain contract ‚Äî independent c·ªßa infrastructure.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">04</span>
      <span class="q-text">Singleton Pattern ‚Äî implement thread-safe trong Go. Khi n√†o n√™n d√πng v√† kh√¥ng n√™n d√πng?</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">ƒê·ªãnh nghƒ©a</div>
      <div class="answer-text">
        <p>Singleton ƒë·∫£m b·∫£o ch·ªâ c√≥ <strong>m·ªôt instance duy nh·∫•t</strong> c·ªßa m·ªôt type trong to√†n b·ªô application lifecycle. D√πng cho: DB connection pool, config, logger ‚Äî nh·ªØng th·ª© expensive to create v√† share ƒë∆∞·ª£c.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ Pattern 1: sync.Once ‚Äî idiomatic Go ‚îÄ‚îÄ</span>
<span class="kw">var</span> (
    dbInstance *sql.DB
    dbOnce     sync.Once
)

<span class="kw">func</span> GetDB(cfg *Config) *sql.DB {
    dbOnce.Do(<span class="kw">func</span>() {
        db, err := sql.Open(<span class="str">"postgres"</span>, cfg.DSN)
        <span class="kw">if</span> err != <span class="kw">nil</span> { panic(err) }
        db.SetMaxOpenConns(cfg.MaxConns)
        db.SetMaxIdleConns(cfg.MaxIdle)
        db.SetConnMaxLifetime(cfg.ConnLifetime)
        dbInstance = db
    })
    <span class="kw">return</span> dbInstance
}
<span class="cm">// sync.Once ƒë·∫£m b·∫£o Do() ch·ªâ ch·∫°y 1 l·∫ßn duy nh·∫•t</span>
<span class="cm">// Thread-safe, kh√¥ng c·∫ßn mutex t∆∞·ªùng minh</span>
<span class="cm">// D√π 1000 goroutines g·ªçi GetDB() c√πng l√∫c ‚Äî safe</span>

<span class="cm">// ‚îÄ‚îÄ Pattern 2: package-level init ‚Äî ƒë∆°n gi·∫£n h∆°n ‚îÄ‚îÄ</span>
<span class="kw">var</span> DB *sql.DB

<span class="kw">func</span> Init(cfg *Config) {
    DB, _ = sql.Open(<span class="str">"postgres"</span>, cfg.DSN)
}
<span class="cm">// G·ªçi Init() m·ªôt l·∫ßn trong main(), sau ƒë√≥ d√πng DB ·ªü kh·∫Øp n∆°i</span>
<span class="cm">// ƒê∆°n gi·∫£n h∆°n sync.Once nh∆∞ng √≠t flexible</span>

<span class="cm">// ‚îÄ‚îÄ Pattern 3: Constructor injection ‚Äî PREFERRED cho testing ‚îÄ‚îÄ</span>
<span class="kw">type</span> Server <span class="kw">struct</span> { db *sql.DB }
<span class="kw">func</span> NewServer(db *sql.DB) *Server { <span class="kw">return</span> &amp;Server{db: db} }
<span class="cm">// Trong main: db = GetDB(cfg); server = NewServer(db)</span>
<span class="cm">// M·ªói component nh·∫≠n DB qua constructor ‚Äî kh√¥ng g·ªçi global</span></div></div>

      <div class="key-points"><ul>
        <li><strong>N√™n d√πng Singleton cho</strong>: DB connection pool, Redis client, config loader, logger ‚Äî global resource, expensive to create, stateless behavior.</li>
        <li><strong>KH√îNG n√™n d√πng Singleton cho</strong>: object c√≥ state thay ƒë·ªïi theo request (user context, request-scoped data) ‚Äî g√¢y race condition v√† test nightmare.</li>
        <li><strong>Global Singleton vs Injection</strong>: trong production code Go, prefer <strong>constructor injection</strong> ‚Äî pass DB v√†o struct thay v√¨ g·ªçi global <code>GetDB()</code>. D·ªÖ test h∆°n (c√≥ th·ªÉ pass mock), √≠t hidden dependency.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† Singleton trong test g√¢y v·∫•n ƒë·ªÅ g√¨?</div>
        <p>Global singleton b·ªã share gi·ªØa c√°c test cases ‚Üí test kh√¥ng independent ‚Üí order-dependent tests, flaky tests. Fix: inject dependency v√†o constructor thay v√¨ d√πng global. Trong test, inject mock implementation.</p>
      </div>
      <div class="tip-box">
        <div class="tip-box-title">üí° C√¢u tr·∫£ l·ªùi ph√¢n bi·ªát senior</div>
        <p>"M√¨nh d√πng sync.Once ƒë·ªÉ implement Singleton cho DB pool v√† Redis client, nh∆∞ng kh√¥ng expose global variable. Thay v√†o ƒë√≥ inject v√†o struct qua constructor ‚Äî gi·ªØ ƒë∆∞·ª£c Singleton semantics m√† v·∫´n testable. Pattern n√†y c√≤n gi√∫p explicit v·ªÅ dependencies ‚Äî ai ƒë·ªçc code th·∫•y ngay component n√†y c·∫ßn g√¨."</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Design Patterns ‚Äî Bi·∫øt th√™m</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">05</span>
      <span class="q-text">Observer / Pub-Sub v√† Factory Pattern ‚Äî m√¥ t·∫£ nhanh v√† v√≠ d·ª• th·ª±c t·∫ø.</span>
      <span class="q-level easy">Easy</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Observer / Pub-Sub</div>
      <div class="answer-text">
        <p>Subject notify nhi·ªÅu observers khi c√≥ s·ª± ki·ªán. Loose coupling ‚Äî subject kh√¥ng bi·∫øt observer c·ª• th·ªÉ.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="kw">type</span> EventBus <span class="kw">struct</span> {
    handlers <span class="kw">map</span>[<span class="kw">string</span>][]<span class="kw">func</span>(Event)
    mu       sync.RWMutex
}
<span class="kw">func</span> (eb *EventBus) Subscribe(topic <span class="kw">string</span>, h <span class="kw">func</span>(Event)) {
    eb.mu.Lock(); <span class="kw">defer</span> eb.mu.Unlock()
    eb.handlers[topic] = append(eb.handlers[topic], h)
}
<span class="kw">func</span> (eb *EventBus) Publish(topic <span class="kw">string</span>, e Event) {
    eb.mu.RLock(); <span class="kw">defer</span> eb.mu.RUnlock()
    <span class="kw">for</span> _, h := <span class="kw">range</span> eb.handlers[topic] { <span class="kw">go</span> h(e) }
}
<span class="cm">// user.registered ‚Üí emailService, analyticsService, notifyService</span>
bus.Subscribe(<span class="str">"user.registered"</span>, emailSvc.SendWelcome)
bus.Subscribe(<span class="str">"user.registered"</span>, analytics.Track)
bus.Publish(<span class="str">"user.registered"</span>, UserEvent{ID: newUserID})</div></div>

      <div class="ans-label">Factory Pattern</div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// T√°ch logic kh·ªüi t·∫°o, client ch·ªâ bi·∫øt interface</span>
<span class="kw">func</span> NewStorageProvider(kind <span class="kw">string</span>, cfg Config) StorageProvider {
    <span class="kw">switch</span> kind {
    <span class="kw">case</span> <span class="str">"s3"</span>:    <span class="kw">return</span> NewS3Provider(cfg)
    <span class="kw">case</span> <span class="str">"gcs"</span>:   <span class="kw">return</span> NewGCSProvider(cfg)
    <span class="kw">default</span>:     <span class="kw">return</span> NewLocalStorage(cfg)
    }
}
<span class="cm">// D√πng cho: payment gateway, storage provider, notification channel</span>
<span class="cm">// Client: storage := NewStorageProvider(os.Getenv("STORAGE"), cfg)</span></div></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECTION: ENGINEERING PROCESS -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="sec-eng" class="section section-eng">
  <div class="section-head">
    <span class="section-num">05</span>
    <h2 class="section-title">Engineering Process</h2>
  </div>

  <div class="cat-label">Workflow & Task Management</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">01</span>
      <span class="q-text">H√£y k·ªÉ quy tr√¨nh t·ª´ khi nh·∫≠n task ƒë·∫øn khi ho√†n th√†nh. Senior l√†m kh√°c g√¨ junior?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi ‚Äî Senior mindset</div>
      <div class="answer-text">
        <p>Junior nh·∫≠n task ‚Üí code ngay. Senior nh·∫≠n task ‚Üí <strong>hi·ªÉu s√¢u tr∆∞·ªõc khi code</strong>. Quy tr√¨nh:</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>1. Clarify requirements</strong>: ƒë·ªçc k·ªπ task, h·ªèi nh·ªØng ƒëi·ªÅu ch∆∞a r√µ tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu. "Edge cases l√† g√¨? Performance expectation? Scope c√≥ include X kh√¥ng?" ‚Äî h·ªèi s·ªõm t·ªët h∆°n deliver sai.</li>
        <li><strong>2. Technical design</strong>: v·ªõi task ph·ª©c t·∫°p, vi·∫øt mini-design doc ho·∫∑c flow tr∆∞·ªõc. Identify dependencies, risks, c·∫ßn break xu·ªëng sub-tasks kh√¥ng?</li>
        <li><strong>3. Estimate v√† communicate</strong>: estimate th·ªùi gian, communicate n·∫øu c√≥ blocker. Update status proactively, kh√¥ng ƒë·ª£i b·ªã h·ªèi.</li>
        <li><strong>4. Implement theo TDD ho·∫∑c write-test-together</strong>: code + unit test. Kh√¥ng submit PR m√† kh√¥ng c√≥ test.</li>
        <li><strong>5. Self-review tr∆∞·ªõc khi t·∫°o PR</strong>: ƒë·ªçc l·∫°i diff c·ªßa m√¨nh ‚Äî "n·∫øu m√¨nh l√† reviewer, m√¨nh s·∫Ω h·ªèi g√¨?" Gi·∫£i quy·∫øt tr∆∞·ªõc.</li>
        <li><strong>6. PR v·ªõi description r√µ r√†ng</strong>: m√¥ t·∫£ what + why + how. Link ticket, screenshot n·∫øu c√≥ UI change, mention breaking changes.</li>
        <li><strong>7. Address review comments</strong>: respond t·ª´ng comment, kh√¥ng ignore. N·∫øu kh√¥ng ƒë·ªìng √Ω, gi·∫£i th√≠ch reason ‚Äî kh√¥ng ch·ªâ "done".</li>
        <li><strong>8. Test tr√™n staging</strong>: verify sau khi merge, kh√¥ng ch·ªâ tin v√†o CI.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° ƒêi·ªÅu senior l√†m m√† junior kh√¥ng nghƒ© ƒë·∫øn</div>
        <p>Nghƒ© ƒë·∫øn <strong>downstream impact</strong>: thay ƒë·ªïi n√†y ·∫£nh h∆∞·ªüng API contract kh√¥ng? Breaking change cho client? Database migration c√≥ rollback plan kh√¥ng? Monitor sau khi deploy ‚Äî kh√¥ng ch·ªâ deploy xong r·ªìi th√¥i.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Code Review</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">02</span>
      <span class="q-text">Em ƒë√£ t·ª´ng review code cho team ch∆∞a? Quy tr√¨nh review code nh∆∞ th·∫ø n√†o?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Review code kh√¥ng ch·ªâ l√† t√¨m bug ‚Äî ƒë√≥ l√† <strong>knowledge sharing, mentoring, v√† maintain code quality</strong>. Quy tr√¨nh m√¨nh √°p d·ª•ng:</p>
      </div>
      <div class="key-points"><ul>
        <li><strong>1. Hi·ªÉu context tr∆∞·ªõc</strong>: ƒë·ªçc ticket/description c·ªßa PR tr∆∞·ªõc. Hi·ªÉu "why" m·ªõi review "how" ƒë∆∞·ª£c. ƒê·ª´ng nh·∫£y th·∫≥ng v√†o diff.</li>
        <li><strong>2. Correctness tr∆∞·ªõc ti√™n</strong>: logic c√≥ ƒë√∫ng kh√¥ng? Edge cases ƒë∆∞·ª£c handle ch∆∞a? Error handling ƒë·ªß kh√¥ng? Race condition kh√¥ng?</li>
        <li><strong>3. Security</strong>: input validation, auth check, SQL injection, sensitive data b·ªã log kh√¥ng?</li>
        <li><strong>4. Performance</strong>: N+1 query? Unnecessary DB calls? Missing index cho query m·ªõi?</li>
        <li><strong>5. Readability & Maintainability</strong>: t√™n variable/function c√≥ r√µ nghƒ©a kh√¥ng? Function qu√° d√†i? Comment c√≥ c·∫ßn kh√¥ng?</li>
        <li><strong>6. Test coverage</strong>: c√≥ unit test kh√¥ng? Test cover happy path v√† edge cases ch∆∞a?</li>
      </ul></div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Comment review t·ªët: explain reason + suggest fix</span>

<span class="cm">// ‚ùå Bad comment</span>
<span class="cm">// "This is wrong"</span>

<span class="cm">// ‚úÖ Good comment  </span>
<span class="cm">// "This could cause N+1 query when users list is large.</span>
<span class="cm">//  Consider fetching all orders in one query with IN clause:</span>
<span class="cm">//  SELECT * FROM orders WHERE user_id IN (...userIDs)"</span>

<span class="cm">// Ph√¢n lo·∫°i comment</span>
<span class="cm">// [blocking]:  ph·∫£i fix tr∆∞·ªõc khi merge</span>
<span class="cm">// [nit]:       nh·ªè nh·∫∑t, c√≥ th·ªÉ fix ho·∫∑c kh√¥ng</span>
<span class="cm">// [question]:  m√¨nh kh√¥ng hi·ªÉu, c·∫ßn gi·∫£i th√≠ch</span>
<span class="cm">// [suggestion]: idea, kh√¥ng b·∫Øt bu·ªôc</span></div></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† Tr√°nh khi review</div>
        <p>Tr√°nh <strong>nitpicking style</strong> khi ƒë√£ c√≥ linter/formatter ‚Äî ƒë·ªÉ tool l√†m vi·ªác ƒë√≥. Tr√°nh comment mang t√≠nh c√° nh√¢n ("b·∫°n sai r·ªìi") ‚Äî review code, kh√¥ng review ng∆∞·ªùi. Tr√°nh approve PR m√† kh√¥ng th·ª±c s·ª± ƒë·ªçc v√¨ "trust teammate".</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Testing</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">03</span>
      <span class="q-text">Em c√≥ d√πng Unit Test kh√¥ng? Define test nh∆∞ th·∫ø n√†o? Mock dependency ra sao trong Go?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>C√≥. Unit test verify m·ªôt unit (function/method) ho·∫°t ƒë·ªông ƒë√∫ng <strong>ƒë·ªôc l·∫≠p v·ªõi dependencies</strong>. Go c√≥ built-in testing package, kh√¥ng c·∫ßn framework b√™n ngo√†i.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// user_usecase_test.go</span>
<span class="kw">package</span> usecase_test

<span class="cm">// 1. ƒê·ªãnh nghƒ©a mock implement interface</span>
<span class="kw">type</span> mockUserRepo <span class="kw">struct</span> {
    findByIDFunc <span class="kw">func</span>(ctx context.Context, id <span class="kw">string</span>) (*User, <span class="kw">error</span>)
}
<span class="kw">func</span> (m *mockUserRepo) <span class="fn">FindByID</span>(ctx context.Context, id <span class="kw">string</span>) (*User, <span class="kw">error</span>) {
    <span class="kw">return</span> m.<span class="fn">findByIDFunc</span>(ctx, id)
}

<span class="cm">// 2. Table-driven tests ‚Äî idiomatic Go</span>
<span class="kw">func</span> <span class="fn">TestGetProfile</span>(t *testing.T) {
    tests := []<span class="kw">struct</span>{
        name    <span class="kw">string</span>
        userID  <span class="kw">string</span>
        mockFn  <span class="kw">func</span>() (*User, <span class="kw">error</span>)
        wantErr <span class="kw">bool</span>
    }{
        {
            name:   <span class="str">"success"</span>,
            userID: <span class="str">"u1"</span>,
            mockFn: <span class="kw">func</span>() (*User, <span class="kw">error</span>) { <span class="kw">return</span> &amp;User{ID: <span class="str">"u1"</span>}, <span class="kw">nil</span> },
            wantErr: <span class="kw">false</span>,
        },
        {
            name:   <span class="str">"not found"</span>,
            userID: <span class="str">"u999"</span>,
            mockFn: <span class="kw">func</span>() (*User, <span class="kw">error</span>) { <span class="kw">return</span> <span class="kw">nil</span>, ErrNotFound },
            wantErr: <span class="kw">true</span>,
        },
    }

    <span class="kw">for</span> _, tt := <span class="kw">range</span> tests {
        t.<span class="fn">Run</span>(tt.name, <span class="kw">func</span>(t *testing.T) {
            repo := &amp;mockUserRepo{findByIDFunc: <span class="kw">func</span>(_ context.Context, _ <span class="kw">string</span>) (*User, <span class="kw">error</span>) {
                <span class="kw">return</span> tt.<span class="fn">mockFn</span>()
            }}
            uc := <span class="fn">NewUserUsecase</span>(repo)
            _, err := uc.<span class="fn">GetProfile</span>(context.<span class="fn">Background</span>(), tt.userID)
            <span class="kw">if</span> (err != <span class="kw">nil</span>) != tt.wantErr {
                t.<span class="fn">Errorf</span>(<span class="str">"got err=%v, wantErr=%v"</span>, err, tt.wantErr)
            }
        })
    }
}</div></div>
      <div class="key-points"><ul>
        <li><strong>Table-driven tests</strong>: idiomatic Go ‚Äî d·ªÖ th√™m test case, d·ªÖ ƒë·ªçc.</li>
        <li><strong>Mock b·∫±ng interface</strong>: v√¨ Go d√πng implicit interface, t·∫°o mock ƒë∆°n gi·∫£n. Ho·∫∑c d√πng <strong>testify/mock</strong>, <strong>mockgen</strong> ƒë·ªÉ generate mock t·ª± ƒë·ªông.</li>
        <li><strong>Test coverage</strong>: <code>go test -cover ./...</code>. M·ª•c ti√™u reasonable: 70-80% cho business logic. Kh√¥ng c·∫ßn 100%.</li>
        <li><strong>Integration test</strong>: d√πng <code>testcontainers-go</code> ƒë·ªÉ spin up real Postgres trong Docker cho integration test.</li>
      </ul></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECTION: NESTJS / NODE.JS ‚Äî Senior Level         -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="sec-nest" class="section section-nest">
  <div class="section-head">
    <span class="section-num">06</span>
    <h2 class="section-title">NestJS / Node.js <span style="font-size:14px;font-weight:400;opacity:0.6">‚Äî Senior Level</span></h2>
  </div>

  <div class="cat-label">Node.js Core & Event Loop</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">01</span>
      <span class="q-text">Event Loop ho·∫°t ƒë·ªông th·∫ø n√†o? T·∫°i sao single-threaded v·∫´n handle ƒë∆∞·ª£c nhi·ªÅu request? Khi n√†o block event loop?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>Node.js ch·∫°y tr√™n <strong>single thread</strong> nh∆∞ng handle I/O concurrently nh·ªù <strong>Event Loop + libuv</strong>. M·ªói async op (DB query, HTTP call) ƒë∆∞·ª£c ƒë·∫©y ra OS ho·∫∑c libuv thread pool ‚Äî gi·∫£i ph√≥ng main thread ƒë·ªÉ nh·∫≠n request kh√°c. Khi I/O xong, callback ƒë∆∞·ª£c queue v√†o Event Loop ƒë·ªÉ pick up.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Event Loop phases ‚Äî th·ª±c thi theo th·ª© t·ª± n√†y m·ªói v√≤ng:</span>
<span class="cm">// 1. timers     ‚Äî setTimeout / setInterval ƒë√£ h·∫øt h·∫°n</span>
<span class="cm">// 2. I/O        ‚Äî async I/O callbacks (network, file)</span>
<span class="cm">// 3. poll       ‚Äî fetch new I/O events, BLOCK ·ªü ƒë√¢y n·∫øu queue r·ªóng</span>
<span class="cm">// 4. check      ‚Äî setImmediate() callbacks</span>
<span class="cm">// 5. close      ‚Äî socket.on("close") callbacks</span>

<span class="cm">// Microtask queue ‚Äî ch·∫°y SAU M·ªñI phase, tr∆∞·ªõc phase k·∫ø ti·∫øp:</span>
<span class="cm">// process.nextTick()  ‚Üê ∆∞u ti√™n cao nh·∫•t, tr∆∞·ªõc Promise</span>
<span class="cm">// Promise.then() / await</span>

console.log(<span class="str">"1: sync"</span>);
process.nextTick(() =&gt; console.log(<span class="str">"2: nextTick"</span>));
Promise.resolve().then(() =&gt; console.log(<span class="str">"3: Promise"</span>));
setImmediate(() =&gt; console.log(<span class="str">"4: setImmediate"</span>));
setTimeout(() =&gt; console.log(<span class="str">"5: setTimeout 0"</span>), 0);
<span class="cm">// Output: 1 ‚Üí 2 ‚Üí 3 ‚Üí 4 ‚Üí 5  (nextTick tr∆∞·ªõc Promise, setImmediate sau c√πng)</span></div></div>
      <div class="key-points"><ul>
        <li><strong>libuv thread pool</strong> (m·∫∑c ƒë·ªãnh 4 threads): x·ª≠ l√Ω <code>fs</code>, <code>crypto</code>, <code>dns.lookup</code>. TƒÉng qua <code>UV_THREADPOOL_SIZE=16</code>.</li>
        <li><strong>Network I/O</strong> (TCP/UDP) d√πng OS async tr·ª±c ti·∫øp ‚Äî kh√¥ng c·∫ßn thread pool, n√™n r·∫•t nhanh.</li>
        <li><strong>Block event loop</strong>: heavy regex, <code>JSON.parse</code> file l·ªõn, crypto sync ‚Üí m·ªçi request b·ªã treo. Fix: d√πng Worker Threads.</li>
        <li><strong>Ph√π h·ª£p</strong>: I/O-bound high concurrency (API gateway, BFF, chat). <strong>Kh√¥ng ph√π h·ª£p</strong>: CPU-bound (video transcode, ML).</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Senior-level: c√°ch measure event loop lag</div>
        <p><code>perf_hooks.monitorEventLoopDelay()</code> (Node 11+) ƒë·ªÉ detect lag. Lag &gt; 100ms consistently ‚Üí c√≥ blocking code. <code>clinic doctor</code> visualize event loop utilization theo time. Alert khi lag v∆∞·ª£t ng∆∞·ª°ng trong production.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">02</span>
      <span class="q-text">Async/Await pitfalls senior hay g·∫∑p ‚Äî unhandled rejection, sequential vs parallel, error trong forEach?</span>
      <span class="q-level med">Medium</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi ‚Äî Focus v√†o pitfalls, kh√¥ng ph·∫£i basics</div>
      <div class="answer-text">
        <p>Async/Await nh√¨n "s·∫°ch" h∆°n callback hell, nh∆∞ng ·∫©n ch·ª©a <strong>nhi·ªÅu pitfalls m√† junior hay m·∫Øc</strong>. Senior c·∫ßn bi·∫øt: <strong>sequential vs parallel execution</strong>, <strong>unhandled rejection crashing Node 15+</strong>, v√† <strong>async forEach kh√¥ng ho·∫°t ƒë·ªông nh∆∞ mong ƒë·ª£i</strong>.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ Pitfall 1: await tu·∫ßn t·ª± khi c√≥ th·ªÉ parallel ‚îÄ‚îÄ</span>
<span class="cm">// BAD: 300ms total (100 + 100 + 100ms)</span>
const user    = await getUser(id);
const config  = await getConfig();
const perms   = await getPermissions();

<span class="cm">// GOOD: 100ms total (parallel)</span>
const [user, config, perms] = await Promise.all([
  getUser(id), getConfig(), getPermissions(),
]);
<span class="cm">// allSettled khi partial failure ok:</span>
const results = await Promise.allSettled([op1(), op2()]);
results.forEach(r =&gt; r.status === "fulfilled" ? use(r.value) : log(r.reason));

<span class="cm">// ‚îÄ‚îÄ Pitfall 2: async trong forEach ‚Äî errors b·ªã swallow ‚îÄ‚îÄ</span>
<span class="cm">// BAD: forEach kh√¥ng await, unhandled rejection</span>
items.forEach(async (item) =&gt; { await process(item); });

<span class="cm">// GOOD:</span>
await Promise.all(items.map(item =&gt; process(item)));  <span class="cm">// parallel</span>
for (const item of items) { await process(item); }   <span class="cm">// sequential n·∫øu c·∫ßn order</span>

<span class="cm">// ‚îÄ‚îÄ Pitfall 3: unhandled rejection ‚Äî crash Node 15+ ‚îÄ‚îÄ</span>
process.on("unhandledRejection", (reason, promise) =&gt; {
  logger.error("Unhandled rejection", { reason });
  <span class="cm">// graceful shutdown n·∫øu critical error</span>
});

<span class="cm">// ‚îÄ‚îÄ Pitfall 4: Promise timeout pattern ‚îÄ‚îÄ</span>
const withTimeout = &lt;T&gt;(promise: Promise&lt;T&gt;, ms: number): Promise&lt;T&gt; =&gt;
  Promise.race([
    promise,
    new Promise&lt;never&gt;((_, reject) =&gt;
      setTimeout(() =&gt; reject(new Error("Timeout")), ms)
    ),
  ]);</div></div>
      <div class="key-points"><ul>
        <li><strong>Promise.race</strong>: resolve/reject ngay khi c√°i ƒë·∫ßu ti√™n settle ‚Äî d√πng cho timeout pattern.</li>
        <li><strong>Promise.any</strong>: resolve ngay khi c√°i ƒë·∫ßu ti√™n resolve, reject khi T·∫§T C·∫¢ reject ‚Äî d√πng cho fallback pattern.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† B·∫´y hay g·∫∑p</div>
        <p><strong>Top-level await</strong> ch·ªâ ho·∫°t ƒë·ªông trong ES Modules (<code>"type": "module"</code> trong package.json ho·∫∑c file <code>.mjs</code>). Trong CommonJS, top-level await s·∫Ω <strong>syntax error</strong>. NestJS m·∫∑c ƒë·ªãnh d√πng CommonJS ‚Äî c·∫ßn wrap trong async IIFE ho·∫∑c d√πng <code>bootstrap()</code> function.</p>
      </div>
      <div class="tip-box">
        <div class="tip-box-title">üí° C√¢u tr·∫£ l·ªùi g√¢y ·∫•n t∆∞·ª£ng</div>
        <p>"Trong production, m√¨nh lu√¥n d√πng <code>Promise.allSettled</code> thay v√¨ <code>Promise.all</code> khi partial failure acceptable ‚Äî v√≠ d·ª• g·ª≠i notification cho 100 users, kh√¥ng n√™n fail to√†n b·ªô v√¨ 1 user. V√† d√πng <code>AbortController</code> thay v√¨ Promise.race timeout ƒë·ªÉ cleanup resources properly."</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Decorator & Metadata ‚Äî Th·ª±c t·∫ø ƒë√£ d√πng</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">03</span>
      <span class="q-text">Decorator trong NestJS ‚Äî Reflect.metadata ho·∫°t ƒë·ªông th·∫ø n√†o? Vi·∫øt Custom Decorator production-grade?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">C∆° ch·∫ø: Reflect.metadata + emitDecoratorMetadata</div>
      <div class="answer-text">
        <p>NestJS d√πng <strong>reflect-metadata</strong> polyfill ƒë·ªÉ attach metadata v√†o class/method/param l√∫c compile time (TypeScript decorators). Runtime ƒë·ªçc metadata ƒë·ªÉ t·ª± routing, inject, guard.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// C∆° ch·∫ø b√™n trong:</span>
<span class="cm">// @Controller("users") th·ª±c ch·∫•t l√†:</span>
Reflect.defineMetadata("path", "users", UserController);
<span class="cm">// emitDecoratorMetadata: true ‚Üí TypeScript t·ª± emit type info:</span>
Reflect.defineMetadata("design:paramtypes", [UserRepo, Logger], UserService);
<span class="cm">// ‚Üí NestJS bi·∫øt inject ƒë√∫ng type m√† kh√¥ng c·∫ßn annotation th√™m</span>

<span class="cm">// ‚îÄ‚îÄ Custom Param Decorator: @CurrentUser() ‚îÄ‚îÄ</span>
export const CurrentUser = createParamDecorator(
  (field: keyof User | undefined, ctx: ExecutionContext) =&gt; {
    const req = ctx.switchToHttp().getRequest&lt;Request & { user: User }&gt;();
    return field ? req.user?.[field] : req.user;
  },
);
<span class="cm">// @CurrentUser() user: User  ho·∫∑c  @CurrentUser("id") userId: string</span>

<span class="cm">// ‚îÄ‚îÄ Custom Class Decorator: @Roles() + @Public() ‚îÄ‚îÄ</span>
export const ROLES_KEY = "roles";
export const Roles = (...roles: Role[]) =&gt; SetMetadata(ROLES_KEY, roles);
export const Public = () =&gt; SetMetadata("isPublic", true);

<span class="cm">// ‚îÄ‚îÄ applyDecorators: compose nhi·ªÅu decorators th√†nh 1 ‚îÄ‚îÄ</span>
export const Auth = (...roles: Role[]) =&gt; applyDecorators(
  Roles(...roles),
  UseGuards(JwtAuthGuard, RolesGuard),
  ApiBearerAuth(),        <span class="cm">// Swagger</span>
  ApiUnauthorizedResponse({ description: "Unauthorized" }),
);
<span class="cm">// @Auth("admin") thay v√¨ 4 decorators ri√™ng ‚Äî DRY, nh·∫•t qu√°n</span>

<span class="cm">// ‚îÄ‚îÄ Custom method decorator: @AuditLog() ‚îÄ‚îÄ</span>
export function AuditLog(action: string) {
  return function (target: any, key: string, descriptor: PropertyDescriptor) {
    const original = descriptor.value;
    descriptor.value = async function (...args: any[]) {
      const result = await original.apply(this, args);
      await auditService.log({ action, args, result }); <span class="cm">// AOP logging</span>
      return result;
    };
  };
}</div></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Khi interviewer h·ªèi "t·∫°i sao Reflector.getAllAndOverride?"</div>
        <p><code>getAllAndOverride</code> check metadata ·ªü method level tr∆∞·ªõc, r·ªìi class level ‚Äî method-level metadata override class-level. <code>getAllAndMerge</code> merge t·∫•t c·∫£ metadata t·ª´ c·∫£ hai. D√πng <code>getAllAndOverride</code> cho roles, <code>getAllAndMerge</code> khi mu·ªën accumulate permissions.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Guards & Interceptors ‚Äî Production Grade</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">04</span>
      <span class="q-text">Implement JWT AuthGuard + RolesGuard production-grade. Request lifecycle th·ª±c thi th·∫ø n√†o?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Request lifecycle ƒë·∫ßy ƒë·ªß</div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// Middleware ‚Üí Guard ‚Üí Interceptor(pre) ‚Üí Pipe ‚Üí Handler ‚Üí Interceptor(post) ‚Üí ExceptionFilter</span>

<span class="cm">// ‚îÄ‚îÄ JWT AuthGuard v·ªõi @Public() bypass support ‚îÄ‚îÄ</span>
@Injectable()
export class JwtAuthGuard implements CanActivate {
  constructor(private jwtService: JwtService, private reflector: Reflector) {}

  async canActivate(ctx: ExecutionContext): Promise&lt;boolean&gt; {
    const isPublic = this.reflector.getAllAndOverride&lt;boolean&gt;("isPublic", [
      ctx.getHandler(), ctx.getClass(),
    ]);
    if (isPublic) return true;

    const req = ctx.switchToHttp().getRequest();
    const token = req.headers.authorization?.split(" ")[1];
    if (!token) throw new UnauthorizedException("Missing token");

    try {
      req.user = await this.jwtService.verifyAsync(token, {
        secret: process.env.JWT_SECRET,
      });
      return true;
    } catch {
      throw new UnauthorizedException("Invalid or expired token");
    }
  }
}

<span class="cm">// ‚îÄ‚îÄ RolesGuard ‚Äî ph√¢n quy·ªÅn d·ª±a tr√™n Reflect metadata ‚îÄ‚îÄ</span>
@Injectable()
export class RolesGuard implements CanActivate {
  constructor(private reflector: Reflector) {}

  canActivate(ctx: ExecutionContext): boolean {
    const required = this.reflector.getAllAndOverride&lt;Role[]&gt;(ROLES_KEY, [
      ctx.getHandler(), ctx.getClass(),
    ]);
    if (!required?.length) return true;

    const { user } = ctx.switchToHttp().getRequest();
    if (!required.some(r =&gt; user?.roles?.includes(r)))
      throw new ForbiddenException("Insufficient permissions");
    return true;
  }
}

<span class="cm">// ‚îÄ‚îÄ LoggingInterceptor v·ªõi RxJS + tap ‚îÄ‚îÄ</span>
@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  intercept(ctx: ExecutionContext, next: CallHandler): Observable&lt;any&gt; {
    const { method, url, user } = ctx.switchToHttp().getRequest();
    const start = Date.now();

    return next.handle().pipe(
      tap({
        next: () =&gt; logger.log({ method, url, ms: Date.now()-start, userId: user?.id }),
        error: err =&gt; logger.error({ method, url, ms: Date.now()-start, err: err.message }),
      }),
      map(data =&gt; ({ success: true, data, timestamp: new Date().toISOString() })),
    );
  }
}

<span class="cm">// ‚îÄ‚îÄ QUAN TR·ªåNG: global guard v·ªõi DI ph·∫£i d√πng APP_GUARD ‚îÄ‚îÄ</span>
<span class="cm">// BAD: app.useGlobalGuards(new JwtAuthGuard()) ‚Äî kh√¥ng c√≥ DI</span>
<span class="cm">// GOOD: trong AppModule providers:</span>
{ provide: APP_GUARD, useClass: JwtAuthGuard },   <span class="cm">// c√≥ full DI</span>
{ provide: APP_GUARD, useClass: RolesGuard },</div></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† Guard trong GraphQL context</div>
        <p>Guard m·∫∑c ƒë·ªãnh d√πng <code>switchToHttp()</code> ‚Äî s·∫Ω fail v·ªõi GraphQL request. C·∫ßn check: <code>ctx.getType() === "graphql"</code> v√† d√πng <code>GqlExecutionContext.create(ctx).getContext().req</code> ƒë·ªÉ l·∫•y request ƒë√∫ng c√°ch.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">05</span>
      <span class="q-text">Vi·∫øt CacheInterceptor v√† TransactionInterceptor ‚Äî AOP pattern trong NestJS th·ª±c t·∫ø?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">AOP: t√°ch cross-cutting concern kh·ªèi business logic</div>
      <div class="answer-text">
        <p><strong>AOP (Aspect-Oriented Programming)</strong> cho ph√©p t√°ch cross-cutting concerns (caching, logging, transaction) ra kh·ªèi business logic. Trong NestJS, <strong>Interceptor l√† c√°ch ch√≠nh ƒë·ªÉ implement AOP</strong> ‚Äî wrap to√†n b·ªô handler execution v·ªõi pre/post logic qua RxJS Observable.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ Cache Interceptor v·ªõi custom TTL decorator ‚îÄ‚îÄ</span>
export const CacheTTL = (ttl: number) =&gt; SetMetadata("cache_ttl", ttl);
export const CacheKey = (key: string) =&gt; SetMetadata("cache_key", key);

@Injectable()
export class HttpCacheInterceptor implements NestInterceptor {
  constructor(
    @Inject(CACHE_MANAGER) private cache: Cache,
    private reflector: Reflector,
  ) {}

  async intercept(ctx: ExecutionContext, next: CallHandler): Promise&lt;Observable&lt;any&gt;&gt; {
    const req = ctx.switchToHttp().getRequest();
    if (req.method !== "GET") return next.handle(); <span class="cm">// ch·ªâ cache GET</span>

    const customKey = this.reflector.get&lt;string&gt;("cache_key", ctx.getHandler());
    const ttl = this.reflector.get&lt;number&gt;("cache_ttl", ctx.getHandler()) ?? 60;
    const key = customKey ?? req.url;

    const cached = await this.cache.get(key);
    if (cached) return of(cached); <span class="cm">// cache HIT ‚Äî bypass handler</span>

    return next.handle().pipe(
      tap(response =&gt; this.cache.set(key, response, ttl)),
    );
  }
}

<span class="cm">// ‚îÄ‚îÄ Transaction Interceptor ‚Äî DB transaction quanh handler ‚îÄ‚îÄ</span>
@Injectable()
export class TransactionInterceptor implements NestInterceptor {
  constructor(private dataSource: DataSource) {}

  async intercept(ctx: ExecutionContext, next: CallHandler): Promise&lt;Observable&lt;any&gt;&gt; {
    const qr = this.dataSource.createQueryRunner();
    await qr.connect();
    await qr.startTransaction();

    ctx.switchToHttp().getRequest().queryRunner = qr; <span class="cm">// inject v√†o request</span>

    return next.handle().pipe(
      tap(async () =&gt; await qr.commitTransaction()),
      catchError(async (err) =&gt; {
        await qr.rollbackTransaction();
        throw err;
      }),
      finalize(() =&gt; qr.release()),
    );
  }
}
<span class="cm">// @UseInterceptors(TransactionInterceptor) ‚Äî handler kh√¥ng bi·∫øt transaction</span>
<span class="cm">// Repository nh·∫≠n queryRunner t·ª´ request ƒë·ªÉ d√πng chung transaction</span></div></div>
      <div class="key-points"><ul>
        <li><strong>Cache Interceptor</strong>: ch·ªâ cache GET request, d√πng custom <code>@CacheTTL()</code> v√† <code>@CacheKey()</code> decorators ƒë·ªÉ control per-endpoint.</li>
        <li><strong>Transaction Interceptor</strong>: wrap handler trong DB transaction ‚Äî t·ª± commit khi success, rollback khi error. Handler kh√¥ng bi·∫øt transaction t·ªìn t·∫°i (SRP).</li>
        <li><strong>RxJS operators</strong>: <code>tap</code> (side-effect), <code>map</code> (transform), <code>catchError</code> (handle error), <code>finalize</code> (cleanup) ‚Äî n·∫Øm v·ªØng 4 operators n√†y l√† ƒë·ªß cho m·ªçi interceptor.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° T·∫°i sao interceptor, kh√¥ng ph·∫£i middleware?</div>
        <p>Middleware kh√¥ng c√≥ access v√†o Reflect metadata (TTL, cache key) v√† kh√¥ng wrap response stream. Interceptor c√≥ <strong>c·∫£ hai</strong>: ƒë·ªçc decorator metadata qua Reflector v√† control to√†n b·ªô request-response pipeline qua RxJS Observable.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Microservices & gRPC ‚Äî Th·ª±c t·∫ø ƒë√£ d√πng</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">06</span>
      <span class="q-text">NestJS gRPC ‚Äî setup, proto definition, bidirectional streaming, error handling, retry?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>gRPC l√† protocol buffer-based RPC ‚Äî typed contract, binary serialization (nhanh h∆°n JSON ~5x), h·ªó tr·ª£ streaming. NestJS wrap gRPC qua <code>@nestjs/microservices</code>.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ 1. Proto definition ‚îÄ‚îÄ</span>
syntax = "proto3";
package user;
service UserService {
  rpc GetUser (UserRequest) returns (UserResponse);              // unary
  rpc StreamEvents (EventRequest) returns (stream EventResponse); // server stream
  rpc Chat (stream ChatMessage) returns (stream ChatMessage);    // bidirectional
}
message UserRequest  { string user_id = 1; }
message UserResponse { string id = 1; string email = 2; }

<span class="cm">// ‚îÄ‚îÄ 2. Server: gRPC handler ‚îÄ‚îÄ</span>
@Controller()
export class UserGrpcController {
  @GrpcMethod("UserService", "GetUser")
  async getUser(data: UserRequest, metadata: Metadata): Promise&lt;UserResponse&gt; {
    const user = await this.userSvc.findById(data.userId);
    if (!user) throw new RpcException({ code: status.NOT_FOUND, message: "Not found" });
    return { id: user.id, email: user.email };
  }

  @GrpcStreamMethod("UserService", "Chat")
  chat(messages: Observable&lt;ChatMessage&gt;): Observable&lt;ChatMessage&gt; {
    return messages.pipe(
      map(msg =&gt; ({ text: `Echo: ${msg.text}`, userId: msg.userId })),
      catchError(err =&gt; throwError(() =&gt; new RpcException(err))),
    );
  }
}

<span class="cm">// ‚îÄ‚îÄ 3. Client: g·ªçi gRPC v·ªõi timeout + retry ‚îÄ‚îÄ</span>
@Injectable()
export class OrderService implements OnModuleInit {
  private userSvc: UserServiceClient;
  constructor(@Inject("USER_PACKAGE") private client: ClientGrpc) {}

  onModuleInit() {
    this.userSvc = this.client.getService&lt;UserServiceClient&gt;("UserService");
  }

  async getUser(userId: string) {
    return firstValueFrom(
      this.userSvc.getUser({ userId }).pipe(
        timeout(3000),
        retry({ count: 2, delay: (err, i) =&gt; timer(i * 1000) }), <span class="cm">// exp backoff</span>
        catchError(err =&gt; throwError(() =&gt; new ServiceUnavailableException())),
      )
    );
  }
}</div></div>
      <div class="key-points"><ul>
        <li><strong>RpcException</strong>: throw v·ªõi gRPC status code (<code>NOT_FOUND</code>, <code>PERMISSION_DENIED</code>). Map sang HTTP qua ExceptionFilter n·∫øu expose qua REST gateway.</li>
        <li><strong>Metadata</strong>: t∆∞∆°ng ƒë∆∞∆°ng HTTP headers ‚Äî truy·ªÅn auth token, request ID, trace ID gi·ªØa services.</li>
        <li><strong>gRPC vs REST</strong>: gRPC t·ªët cho internal service-to-service (typed, fast, streaming). REST t·ªët cho external/public API (browser support, human-readable).</li>
      </ul></div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">07</span>
      <span class="q-text">NestJS + RabbitMQ ‚Äî MessagePattern vs EventPattern, manual ACK, DLQ, v√† retry strategy?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi</div>
      <div class="answer-text">
        <p>NestJS h·ªó tr·ª£ RabbitMQ qua <code>@nestjs/microservices</code>. ƒêi·ªÉm kh√°c bi·ªát ch√≠nh: <strong>MessagePattern</strong> (RPC ‚Äî request/reply, c√≥ response) vs <strong>EventPattern</strong> (fire-and-forget, kh√¥ng c√≥ response). Trong production, <strong>lu√¥n d√πng manual ACK</strong> ƒë·ªÉ tr√°nh m·∫•t message khi service crash.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ Event Pattern v·ªõi manual ACK + DLQ ‚îÄ‚îÄ</span>
@EventPattern("order.created")
async handleOrderCreated(
  @Payload() event: OrderCreatedEvent,
  @Ctx() ctx: RmqContext,
) {
  const channel = ctx.getChannelRef();
  const msg = ctx.getMessage();
  try {
    await this.notificationSvc.sendEmail(event.userId, event.orderId);
    channel.ack(msg);              <span class="cm">// th√†nh c√¥ng: x√≥a kh·ªèi queue</span>
  } catch (err) {
    const retryCount = (msg.properties.headers["x-death"]?.[0]?.count ?? 0);
    if (retryCount &gt;= 3) {
      channel.nack(msg, false, false); <span class="cm">// &gt; 3 l·∫ßn ‚Üí v√†o DLQ</span>
      this.logger.error("Moved to DLQ", event);
    } else {
      channel.nack(msg, false, true);  <span class="cm">// retry: requeue</span>
    }
  }
}

<span class="cm">// ‚îÄ‚îÄ RabbitMQ setup production ‚îÄ‚îÄ</span>
app.connectMicroservice&lt;MicroserviceOptions&gt;({
  transport: Transport.RMQ,
  options: {
    urls: [process.env.RABBITMQ_URL],
    queue: "notification_queue",
    noAck: false,        <span class="cm">// manual ACK ‚Äî kh√¥ng m·∫•t message khi crash</span>
    prefetchCount: 10,   <span class="cm">// backpressure: max 10 messages ƒëang x·ª≠ l√Ω</span>
    queueOptions: {
      durable: true,                          <span class="cm">// survive broker restart</span>
      arguments: {
        "x-dead-letter-exchange": "dlx",      <span class="cm">// NACK ‚Üí DLX</span>
        "x-message-ttl": 86400000,            <span class="cm">// message expire 24h</span>
      },
    },
  },
});</div></div>
      <div class="key-points"><ul>
        <li><strong>noAck: false</strong>: lu√¥n d√πng manual ACK trong production ‚Äî message kh√¥ng m·∫•t khi service crash gi·ªØa ch·ª´ng.</li>
        <li><strong>prefetchCount</strong>: gi·ªõi h·∫°n s·ªë messages consumer nh·∫≠n c√πng l√∫c ‚Äî backpressure, tr√°nh OOM.</li>
        <li><strong>x-death header</strong>: RabbitMQ t·ª± track s·ªë l·∫ßn message b·ªã nack/expired ‚Äî d√πng ƒë·ªÉ implement retry limit.</li>
      </ul></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† MessagePattern vs EventPattern ‚Äî ƒë·ª´ng nh·∫ßm l·∫´n</div>
        <p><strong>MessagePattern</strong>: Request-Reply ‚Äî client <code>send()</code> v√† <strong>ch·ªù response</strong>. D√πng cho sync operations (get user, validate). <strong>EventPattern</strong>: Fire-and-forget ‚Äî client <code>emit()</code> v√† <strong>kh√¥ng ch·ªù</strong>. D√πng cho async events (order.created, email.send). Nh·∫ßm s·∫Ω g√¢y timeout ho·∫∑c m·∫•t response.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">GraphQL Module ‚Äî Th·ª±c t·∫ø ƒë√£ d√πng</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">08</span>
      <span class="q-text">GraphQL trong NestJS ‚Äî Code-first, DataLoader gi·∫£i quy·∫øt N+1, Subscription, v√† security?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Code-first v·ªõi DataLoader ‚Äî gi·∫£i quy·∫øt N+1</div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ Setup ‚îÄ‚îÄ</span>
GraphQLModule.forRoot&lt;ApolloDriverConfig&gt;({
  driver: ApolloDriver,
  autoSchemaFile: true,           <span class="cm">// code-first: generate schema t·ª´ decorators</span>
  context: ({ req }) =&gt; ({ req }),
  subscriptions: { "graphql-ws": true },
  introspection: false,           <span class="cm">// disable trong production!</span>
  plugins: [ApolloServerPluginUsageReporting()],
})

<span class="cm">// ‚îÄ‚îÄ Resolver + Field Resolver ‚îÄ‚îÄ</span>
@Resolver(() =&gt; User)
export class UserResolver {
  constructor(private ordersLoader: OrdersDataLoader) {}

  @Query(() =&gt; User)
  @UseGuards(GqlAuthGuard)
  async user(@Args("id", { type: () =&gt; ID }) id: string) {
    return this.userSvc.findById(id);
  }

  @ResolveField("orders", () =&gt; [Order])
  async orders(@Parent() user: User): Promise&lt;Order[]&gt; {
    return this.ordersLoader.load(user.id); <span class="cm">// DataLoader batch!</span>
  }

  @Subscription(() =&gt; Order, {
    filter: (payload, variables) =&gt;
      payload.orderCreated.userId === variables.userId,
  })
  orderCreated(@Args("userId") userId: string) {
    return this.pubSub.asyncIterator("ORDER_CREATED");
  }
}

<span class="cm">// ‚îÄ‚îÄ DataLoader: batch N user IDs ‚Üí 1 query ‚îÄ‚îÄ</span>
@Injectable({ scope: Scope.REQUEST }) <span class="cm">// REQUEST scope: 1 loader per request</span>
export class OrdersDataLoader implements NestDataLoader&lt;string, Order[]&gt; {
  constructor(private orderRepo: OrderRepository) {}

  generateDataLoader(): DataLoader&lt;string, Order[]&gt; {
    return new DataLoader(async (userIds: readonly string[]) =&gt; {
      const orders = await this.orderRepo.findByUserIds([...userIds]);
      const grouped = groupBy(orders, "userId");
      return userIds.map(id =&gt; grouped[id] ?? []);
      <span class="cm">// 1 query: SELECT * FROM orders WHERE user_id IN (id1, id2, ...)</span>
      <span class="cm">// Thay v√¨ N queries cho N users ‚Äî gi·∫£i quy·∫øt ho√†n to√†n N+1</span>
    });
  }
}

<span class="cm">// ‚îÄ‚îÄ GqlAuthGuard: context kh√°c HTTP ‚îÄ‚îÄ</span>
@Injectable()
export class GqlAuthGuard extends AuthGuard("jwt") {
  getRequest(ctx: ExecutionContext) {
    const gqlCtx = GqlExecutionContext.create(ctx);
    return gqlCtx.getContext().req; <span class="cm">// l·∫•y request t·ª´ GQL context, kh√¥ng ph·∫£i HTTP</span>
  }
}</div></div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† GraphQL security ‚Äî kh√¥ng ƒë·ªÉ defaults trong production</div>
        <p><strong>Introspection OFF</strong>: kh√¥ng expose schema cho attacker. <strong>Query depth limit</strong>: <code>graphql-depth-limit</code> plugin ‚Äî reject query l·ªìng s√¢u qu√° N level (DoS vector). <strong>Query complexity</strong>: t√≠nh cost c·ªßa m·ªói field, reject query qu√° expensive. <strong>Rate limit per operation</strong> kh√°c v·ªõi rate limit per IP.</p>
      </div>
    </div>
  </div>

  <div class="cat-label">Architecture & Testing</div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">09</span>
      <span class="q-text">DDD trong NestJS ‚Äî Aggregate Root, Domain Events, CQRS pattern th·ª±c t·∫ø?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">Tr·∫£ l·ªùi ‚Äî Domain-Driven Design trong NestJS</div>
      <div class="answer-text">
        <p><strong>DDD trong NestJS</strong> t·∫≠n d·ª•ng <code>@nestjs/cqrs</code> module. <strong>Aggregate Root</strong> l√† boundary cho consistency ‚Äî t·∫•t c·∫£ thay ƒë·ªïi state ph·∫£i ƒëi qua aggregate root. <strong>Domain Events</strong> decouple side-effects (g·ª≠i email, update inventory) kh·ªèi core logic. <strong>CQRS</strong> t√°ch Command (write) v√† Query (read) ƒë·ªÉ optimize ƒë·ªôc l·∫≠p.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ Aggregate Root v·ªõi Domain Events (NestJS CQRS) ‚îÄ‚îÄ</span>
export class Order extends AggregateRoot {
  private constructor(
    public readonly id: string,
    private _status: OrderStatus,
    private _items: OrderItem[],
    private _total: Money,
  ) { super(); }

  static create(props: CreateOrderProps): Order {
    const order = new Order(uuid(), OrderStatus.PENDING, props.items,
      Money.calculate(props.items));
    order.apply(new OrderCreatedEvent(order)); <span class="cm">// emit domain event</span>
    return order;
  }

  confirm(): void {
    if (this._status !== OrderStatus.PENDING)
      throw new DomainException("Only pending orders can be confirmed");
    this._status = OrderStatus.CONFIRMED;
    this.apply(new OrderConfirmedEvent(this.id));
  }
}

<span class="cm">// ‚îÄ‚îÄ CQRS Command Handler ‚îÄ‚îÄ</span>
@CommandHandler(CreateOrderCommand)
export class CreateOrderHandler implements ICommandHandler&lt;CreateOrderCommand&gt; {
  constructor(
    private repo: IOrderRepository,
    private publisher: EventPublisher,
  ) {}

  async execute(cmd: CreateOrderCommand): Promise&lt;Order&gt; {
    const order = this.publisher.mergeObjectContext(Order.create(cmd));
    await this.repo.save(order);
    order.commit(); <span class="cm">// publish t·∫•t c·∫£ pending domain events ‚Üí EventBus</span>
    return order;
  }
}

<span class="cm">// ‚îÄ‚îÄ Event Handler: react to domain event ‚îÄ‚îÄ</span>
@EventsHandler(OrderCreatedEvent)
export class OrderCreatedHandler implements IEventHandler&lt;OrderCreatedEvent&gt; {
  async handle(event: OrderCreatedEvent) {
    await this.emailSvc.sendConfirmation(event.userId);
    await this.inventorySvc.reserve(event.items);
    this.client.emit("order.created", event); <span class="cm">// publish to Kafka/RabbitMQ</span>
  }
}</div></div>
      <div class="key-points"><ul>
        <li><strong>AggregateRoot.apply()</strong>: register domain event. <strong>commit()</strong>: publish t·∫•t c·∫£ events qua NestJS EventBus sau khi save th√†nh c√¥ng.</li>
        <li><strong>CQRS</strong>: Command (write) v√† Query (read) t√°ch bi·ªát ‚Äî Command Handler thay ƒë·ªïi state, Query Handler ƒë·ªçc data (c√≥ th·ªÉ t·ª´ read model kh√°c).</li>
        <li><strong>Domain Event vs Application Event</strong>: Domain Event thu·ªôc domain layer (kh√¥ng import framework). Application Event l√† NestJS EventEmitter ‚Äî infrastructure.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° Khi n√†o d√πng CQRS trong NestJS?</div>
        <p>CQRS c√≥ overhead (command bus, event bus, handlers) ‚Äî <strong>ch·ªâ d√πng khi domain ph·ª©c t·∫°p</strong>: nhi·ªÅu side-effects sau m·ªói action, c·∫ßn event sourcing, ho·∫∑c read/write model kh√°c nhau (v√≠ d·ª•: write v√†o PostgreSQL, read t·ª´ Elasticsearch). CRUD app ƒë∆°n gi·∫£n th√¨ <strong>service layer l√† ƒë·ªß</strong>.</p>
      </div>
    </div>
  </div>

  <div class="q-card" onclick="toggleCard(this)">
    <div class="q-header">
      <span class="q-num">10</span>
      <span class="q-text">Testing NestJS senior-level ‚Äî unit test use-case, integration test v·ªõi TestContainers, E2E test GraphQL?</span>
      <span class="q-level hard">Hard</span>
      <span class="q-toggle">+</span>
    </div>
    <div class="q-body">
      <div class="ans-label">3 c·∫•p ƒë·ªô testing production</div>
      <div class="answer-text">
        <p>Testing trong NestJS chia 3 c·∫•p ƒë·ªô: <strong>Unit test</strong> (test domain logic, mock dependencies, ch·∫°y c·ª±c nhanh), <strong>Integration test</strong> (test v·ªõi real DB qua TestContainers), v√† <strong>E2E test</strong> (test full HTTP/GraphQL flow). T·ª∑ l·ªá khuy·∫øn ngh·ªã: <strong>70% Unit, 20% Integration, 10% E2E</strong>.</p>
      </div>
      <div class="code-block"><div class="code-block-inner"><span class="cm">// ‚îÄ‚îÄ 1. Unit Test: use-case v·ªõi mock ‚îÄ‚îÄ</span>
describe("CreateOrderHandler", () =&gt; {
  let handler: CreateOrderHandler;
  let repo: jest.Mocked&lt;IOrderRepository&gt;;

  beforeEach(async () =&gt; {
    const module = await Test.createTestingModule({
      providers: [
        CreateOrderHandler,
        { provide: IOrderRepository, useValue: { save: jest.fn() } },
        { provide: EventPublisher, useValue: { mergeObjectContext: jest.fn(o =&gt; o) } },
      ],
    }).compile();
    handler = module.get(CreateOrderHandler);
    repo = module.get(IOrderRepository);
  });

  it("should create order and commit domain events", async () =&gt; {
    repo.save.mockResolvedValue(undefined);
    const spy = jest.spyOn(Order.prototype, "commit");

    await handler.execute(new CreateOrderCommand({ userId: "u1", items: [] }));

    expect(repo.save).toHaveBeenCalled();
    expect(spy).toHaveBeenCalled(); <span class="cm">// domain events published</span>
  });
});

<span class="cm">// ‚îÄ‚îÄ 2. Integration Test v·ªõi TestContainers ‚îÄ‚îÄ</span>
describe("OrderRepository (integration)", () =&gt; {
  let container: StartedPostgreSqlContainer;

  beforeAll(async () =&gt; {
    container = await new PostgreSqlContainer().start();
    dataSource = await createDataSource(container.getConnectionUri()).initialize();
    await dataSource.runMigrations(); <span class="cm">// test v·ªõi real migrations</span>
  });
  afterAll(async () =&gt; { await dataSource.destroy(); await container.stop(); });

  it("should persist aggregate and retrieve by id", async () =&gt; {
    const order = Order.create({ userId: "u1", items: [] });
    await repo.save(order);
    const found = await repo.findById(order.id);
    expect(found.id).toBe(order.id);
  });
});

<span class="cm">// ‚îÄ‚îÄ 3. E2E Test: GraphQL mutation ‚îÄ‚îÄ</span>
describe("OrderResolver (e2e)", () =&gt; {
  beforeAll(async () =&gt; {
    const module = await Test.createTestingModule({ imports: [AppModule] })
      .overrideProvider(DataSource).useValue(testDataSource) <span class="cm">// swap real DB</span>
      .compile();
    app = module.createNestApplication();
    await app.init();
  });

  it("createOrder mutation returns PENDING order", async () =&gt; {
    const { body } = await request(app.getHttpServer())
      .post("/graphql")
      .set("Authorization", `Bearer ${testJwt}`)
      .send({ query: `mutation { createOrder(input:{userId:"u1",items:[]}) { id status } }` })
      .expect(200);

    expect(body.data.createOrder.status).toBe("PENDING");
    expect(body.errors).toBeUndefined();
  });
});</div></div>
      <div class="key-points"><ul>
        <li><strong>Unit test</strong>: test domain + use-case logic ‚Äî kh√¥ng c·∫ßn DB, ch·∫°y &lt;1ms m·ªói test.</li>
        <li><strong>Integration test</strong>: test repository v·ªõi real Postgres qua TestContainers ‚Äî ƒë·∫£m b·∫£o schema v√† query ƒë√∫ng.</li>
        <li><strong>E2E test</strong>: test HTTP/GraphQL flow ‚Äî cover auth, validation, response format. √çt h∆°n nh∆∞ng high-value.</li>
      </ul></div>
      <div class="tip-box">
        <div class="tip-box-title">üí° TestContainers ‚Äî game changer cho integration test</div>
        <p>TestContainers spin up real PostgreSQL/Redis/RabbitMQ Docker container cho m·ªói test suite ‚Äî <strong>kh√¥ng c·∫ßn mock DB</strong>, test v·ªõi real schema v√† migrations. Ch·∫≠m h∆°n unit test (~2-5s startup) nh∆∞ng ƒë·∫£m b·∫£o query, constraint, v√† migration ƒë√∫ng. D√πng <code>beforeAll</code> ƒë·ªÉ start container m·ªôt l·∫ßn cho c·∫£ suite.</p>
      </div>
      <div class="trap-box">
        <div class="trap-box-title">‚ö† Testing pitfall v·ªõi NestJS DI</div>
        <p><code>Test.createTestingModule()</code> t·∫°o NestJS DI container ri√™ng ‚Äî m·ªói test file c√≥ container ƒë·ªôc l·∫≠p. <strong>ƒê·ª´ng d√πng <code>module.get()</code> tr∆∞·ªõc <code>.compile()</code></strong> ‚Äî providers ch∆∞a ƒë∆∞·ª£c resolve. V√† lu√¥n <code>overrideProvider()</code> cho external dependencies (DB, Redis, HTTP) trong E2E test.</p>
      </div>
    </div>
  </div>

</div>

</div><!-- end content-area -->


</body>
</html>